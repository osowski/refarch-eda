(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{fYQq:function(e,t,n){"use strict";n.r(t),n.d(t,"_frontmatter",(function(){return r})),n.d(t,"default",(function(){return b}));n("91GP"),n("rGqo"),n("yt8O"),n("Btvt"),n("RW0V"),n("q1tI");var a=n("7ljp"),l=n("013z");n("qKvR");function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var r={},c={_frontmatter:r},o=l.a;function b(e){var t=e.components,n=function(e,t){if(null==e)return{};var n,a,l={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,["components"]);return Object(a.b)(o,s({},c,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",null,"Kubeless"),Object(a.b)("p",null,"To install kubeless on ICP we first connect to the cluster and then use the command below:"),Object(a.b)("pre",null,Object(a.b)("code",s({parentName:"pre"},{}),"$ kubectl create namespace kubeless\n$ kubectl create -f https://github.com/kubeless/kubeless/releases/download/v1.0.0-alpha.8/kubeless-v1.0.0-alpha.8.yaml -n kubeless\n")),Object(a.b)("p",null,"The image is using RBAC:"),Object(a.b)("p",null,"The deployment creates one pod with 3 containers inside:"),Object(a.b)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(a.b)("span",s({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"24.65277777777778%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAuElEQVQY042R4Q7CIAyEef+X9IfZdDI3WIGxATtbpjMxxkjy5Qppr1DU5AIGS7Ak6jAylnyNB0NVyUeUbcM/S/kwQxgm1nnhONT9mhJSykxCzhmlbMilVP2Fctw9LgmzEJ/KVHNmWfNxFuL6FfJyqQUuRCg9OrQ9QZsACruJJBl+dtv10IPB7b4jBX5ej2YvZCSWRyc5qmejU2vQaOKCd5LMtLlqnC+3atx2GmZytdmnoZzJX3T9iAdyWYQk9hvDGgAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(a.b)("img",s({parentName:"span"},{className:"gatsby-resp-image-image",alt:"drawing",title:"drawing",src:"/refarch-eda/static/4a39e53cfead4c2e9a5708a21bae254d/3cbba/kubeless-deploy.png",srcSet:["/refarch-eda/static/4a39e53cfead4c2e9a5708a21bae254d/7fc1e/kubeless-deploy.png 288w","/refarch-eda/static/4a39e53cfead4c2e9a5708a21bae254d/a5df1/kubeless-deploy.png 576w","/refarch-eda/static/4a39e53cfead4c2e9a5708a21bae254d/3cbba/kubeless-deploy.png 1152w","/refarch-eda/static/4a39e53cfead4c2e9a5708a21bae254d/0b124/kubeless-deploy.png 1728w","/refarch-eda/static/4a39e53cfead4c2e9a5708a21bae254d/3f5bb/kubeless-deploy.png 2152w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    "),Object(a.b)("p",null,"We need to have the ",Object(a.b)("inlineCode",{parentName:"p"},"kubeless")," CLI install:"),Object(a.b)("pre",null,Object(a.b)("code",s({parentName:"pre"},{}),"$ export OS=$(uname -s| tr '[:upper:]' '[:lower:]')\n$ curl -OL https://github.com/kubeless/kubeless/releases/download/$RELEASE/kubeless_$OS-amd64.zip && \\\n  unzip kubeless_$OS-amd64.zip && \\\n  sudo mv bundles/kubeless_$OS-amd64/kubeless /usr/local/bin/\n")),Object(a.b)("h3",null,"To deploy a simple hello"),Object(a.b)("p",null,"The code for this function is under ",Object(a.b)("a",s({parentName:"p"},{href:"https://github.com/ibm-cloud-architecture/refarch-cognitive-analytics/tree/master/src/functions"}),"this repository"),"\nbut it is a simple python function implementing the serverless ‘interface’:"),Object(a.b)("pre",null,Object(a.b)("code",s({parentName:"pre"},{className:"language-python3"}),"def hello(event, context):\n  print(event)\n  return event['data']\n")),Object(a.b)("p",null,"To deploy we can use the command:"),Object(a.b)("pre",null,Object(a.b)("code",s({parentName:"pre"},{}),"$ kubeless function deploy hellojb --runtime python3.6  --trigger-http --from-file functionHello.py --handler functionHello.hello\nINFO[0000] Deploying function...                        \nINFO[0001] Function hellojb submitted for deployment    \nINFO[0001] Check the deployment status executing 'kubeless function ls hellojb'\n")),Object(a.b)("p",null,"To see the functions deployed"),Object(a.b)("pre",null,Object(a.b)("code",s({parentName:"pre"},{}),"$ kubectl get functions\n")),Object(a.b)("p",null,"or"),Object(a.b)("pre",null,Object(a.b)("code",s({parentName:"pre"},{}),"$ kubeless function ls\nNAME    NAMESPACE       HANDLER     RUNTIME     DEPENDENCIES    STATUS       \nhellojb greencompute    test.hello  python3.6                   1/1 READY\n")),Object(a.b)("p",null,"The deployment of a function creates automatically a pod:"),Object(a.b)("pre",null,Object(a.b)("code",s({parentName:"pre"},{}),"$ kubectl describe pod hellojb\n...\nContainers:\n  hellojb:\n    Container ID:   docker://53ca1131747e5b18bfeb67609b4e7bb2400cf45202ade2c03274b9df1eff9bc2\n    Image:          kubeless/python@sha256:0c9f8f727d42625a4e25230cfe612df7488b65f283e7972f84108d87e7443d72\n    Image ID:       docker-pullable://kubeless/python@sha256:0c9f8f727d42625a4e25230cfe612df7488b65f283e7972f84108d87e7443d72\n    Port:           8080/TCP\n    Host Port:      0/TCP\n    State:          Running\n      Started:      Thu, 06 Sep 2018 17:12:52 -0700\n    Ready:          True\n    Restart Count:  0\n    Liveness:       http-get http://:8080/healthz delay=3s timeout=1s period=30s #success=1 #failure=3\n    Environment:\n      FUNC_HANDLER:       hello\n      MOD_NAME:           test\n      FUNC_TIMEOUT:       180\n      FUNC_RUNTIME:       python3.6\n      FUNC_MEMORY_LIMIT:  0\n      FUNC_PORT:          8080\n      PYTHONPATH:         /kubeless/lib/python3.6/site-packages:/kubeless\n    Mounts:\n      /kubeless from hellojb (rw)\n      /var/run/secrets/kubernetes.io/serviceaccount from default-token-9nw2z (ro)\n")),Object(a.b)("p",null,"and kubeless create service for each function:"),Object(a.b)("pre",null,Object(a.b)("code",s({parentName:"pre"},{}),"$ kubectl describe svc hellojb\nName:              hellojb\nNamespace:         greencompute\nLabels:            created-by=kubeless\n                   function=hellojb\nAnnotations:       <none>\nSelector:          created-by=kubeless,function=hellojb\nType:              ClusterIP\nIP:                10.10.10.41\nPort:              http-function-port  8080/TCP\nTargetPort:        8080/TCP\nEndpoints:         192.168.130.101:8080\nSession Affinity:  None\nEvents:            <none>\n")),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"Remove the function")),Object(a.b)("pre",null,Object(a.b)("code",s({parentName:"pre"},{}),"kubeless delete\n")),Object(a.b)("h3",null,"Calling the function"),Object(a.b)("p",null,"The quickest way is to proxy the server and then call the local URL:"),Object(a.b)("pre",null,Object(a.b)("code",s({parentName:"pre"},{}),"$ kubectl proxy -p 8080 &\n$ kubeless function call hellojb --data 'Hello Bill!'\n")),Object(a.b)("p",null,"A second way is to test using HTTP client."),Object(a.b)("h2",null,"Developing a predictive scoring function"),Object(a.b)("p",null,"In ",Object(a.b)("a",s({parentName:"p"},{href:"https://github.com/ibm-cloud-architecture/refarch-asset-analytics/tree/master/asset-predictive-scoring"}),"this project")," we are addressing how to develop a scoring service using Python, sklearn and serveless to deploy the model as function."),Object(a.b)("h2",null,"Compendium"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",s({parentName:"li"},{href:"https://martinfowler.com/articles/serverless.html"}),"Excellent article from Martin Fowler")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",s({parentName:"li"},{href:"https://serverless.com/"}),"Serverless framework"),": The Framework uses new event-driven compute services, like AWS Lambda, Google Cloud Functions, and more. It’s a command-line tool, providing scaffolding, workflow automation and best practices for developing and deploying your serverless architecture."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",s({parentName:"li"},{href:"https://openwhisk.apache.org/"}),"Apache OpenWhisk")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",s({parentName:"li"},{href:"https://github.com/claudiajs/claudia"}),"Claudia to deploy nodejs on AWS lambda")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",s({parentName:"li"},{href:"https://github.com/Miserlou/Zappa"}),"Zappa"),": Zappa makes it super easy to build and deploy server-less, event-driven Python applications on AWS Lambda + API Gateway."),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",s({parentName:"li"},{href:"https://charity.wtf/2016/05/31/operational-best-practices-serverless/"}),"Serverless conf: operational best practices")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",s({parentName:"li"},{href:"http://www.doc.ic.ac.uk/~rbc/papers/fse-serverless-17.pdf"}),"Evaluating cost for FaaS"))))}b.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-serverless-readme-mdx-37eb8dc1a0e36167ed0b.js.map