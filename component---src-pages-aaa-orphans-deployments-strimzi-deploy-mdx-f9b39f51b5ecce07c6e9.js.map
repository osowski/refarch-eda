{"version":3,"sources":["webpack:///./src/pages/aaa_ORPHANS/deployments/strimzi/deploy.mdx"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"mappings":"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","file":"component---src-pages-aaa-orphans-deployments-strimzi-deploy-mdx-f9b39f51b5ecce07c6e9.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/refarch-eda/refarch-eda/docs/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <p><a parentName=\"p\" {...{\n        \"href\": \"https://strimzi.io/\"\n      }}>{`Strimzi`}</a>{` uses the Cluster Operator to deploy and manage Kafka (including Zookeeper) and Kafka Connect clusters. When the Cluster Operator is up, it starts to watch for certain OpenShift or Kubernetes resources containing the desired Kafka or Kafka Connect cluster configuration.`}</p>\n    <h2>{`Create a namespace or openshift project`}</h2>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`kubectl create namespace kafka-strimzi\n\noc create project kafka-strimzi\n`}</code></pre>\n    <h2>{`Download the strimzi artefacts`}</h2>\n    <p>{`For the last `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/strimzi/strimzi-kafka-operator/releases\"\n      }}>{`release github`}</a>{`. Then modify the Role binding yaml files with the namespace set in previous step.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`sed -i '' 's/namespace: .*/namespace: kafka-strimzi/' install/cluster-operator/*RoleBinding*.yaml\n`}</code></pre>\n    <h2>{`Define Custom Resource Definition for kafka`}</h2>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`oc apply -f install/cluster-operator/ -n jb-kafka-strimzi\n`}</code></pre>\n    <p>{`This should create the following resources:`}</p>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`Names`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`Resource`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`Command`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`strimzi-cluster-operator`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`Service account`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`oc get sa`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`strimzi-cluster-operator-entity-operator-delegation, strimzi-cluster-operator, strimzi-cluster-operator-topic-operator-delegation`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`Role binding`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`oc get rolebinding`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`strimzi-cluster-operator-global, strimzi-cluster-operator-namespaced, strimzi-entity-operator, strimzi-kafka-broker, strimzi-topic-operator`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`Cluster Role`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`oc get clusterrole`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`strimzi-cluster-operator, strimzi-cluster-operator-kafka-broker-delegation`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`Cluster Role Binding`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`oc get clusterrolebinding`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`kafkabridges, kafkaconnectors, kafkaconnects, kafkamirrormaker2s kafka, kafkatopics, kafkausers`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`Custom Resource Definition`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`oc get customresourcedefinition`}</td>\n        </tr>\n      </tbody>\n    </table>\n    <h2>{`Deploy Kafka cluster`}</h2>\n    <p>{`Change the name of the cluster in one the yaml in the `}<inlineCode parentName=\"p\">{`examples/kafka`}</inlineCode>{` folder.`}</p>\n    <p>{`Using non presistence:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`oc apply -f examples/kafka/kafka-ephemeral.yaml -n jb-kafka-strimzi\noc get kafka\n# NAME         DESIRED KAFKA REPLICAS   DESIRED ZK REPLICAS\n# my-cluster   3                        3\n# Or\nkubectl  apply -f examples/kafka/kafka-ephemeral.yaml -n jb-kafka-strimzi\n`}</code></pre>\n    <p>{`When looking at the pods running we can see the three kafka and zookeeper nodes, but also an entity operator pod.`}</p>\n    <p>{`Using persistence:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`oc apply -f examples/kafka/kafka-persistent.yaml -n jb-kafka-strimzi\n`}</code></pre>\n    <h2>{`Topic Operator`}</h2>\n    <p>{`The role of the `}<inlineCode parentName=\"p\">{`Topic Operator`}</inlineCode>{` is to keep a set of KafkaTopic OpenShift or Kubernetes resources describing Kafka topics in-sync with corresponding Kafka topics.`}</p>\n    <h3>{`Deploy the operator`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`oc apply -f install/topic-operator/ -n jb-kafka-strimzi\n`}</code></pre>\n    <p>{`This will add the following:`}</p>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`Names`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`Resource`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`Command`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`strimzi-topic-operator`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`Service account`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`oc get sa`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`strimzi-topic-operator`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`Role binding`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`oc get rolebinding`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`kafkatopics`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`Custom Resource Definition`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": \"center\"\n          }}>{`oc get customresourcedefinition`}</td>\n        </tr>\n      </tbody>\n    </table>\n    <h3>{`Create a topic`}</h3>\n    <p>{`Edit a yaml file like the following:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`apiVersion: kafka.strimzi.io/v1beta1\nkind: KafkaTopic\nmetadata:\n  name: test\n  labels:\n    strimzi.io/cluster: my-cluster\nspec:\n  partitions: 1\n  replicas: 3\n  config:\n    retention.ms: 7200000\n    segment.bytes: 1073741824\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`oc apply -f test.yaml -n jb-kafka-strimzi\n\noc get kafkatopics\n`}</code></pre>\n    <p>{`This creates a topic `}<inlineCode parentName=\"p\">{`test`}</inlineCode>{` in your kafka cluster.`}</p>\n    <h2>{`Test with producer and consumer pods`}</h2>\n    <p>{`Use kafka-consumer and producer tools from Kafka distribution. Verify within Dockerhub under the Strimzi account to get the lastest image tag (below we use -2.4.0 tag).`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`# Start a consumer on test topic\n\noc run kafka-consumer -ti --image=strimzi/kafka:latest-kafka-2.4.0 --rm=true --restart=Never -- bin/kafka-console-consumer.sh --bootstrap-server my-cluster-kafka-bootstrap:9092 --topic test --from-beginning\n# Start a text producer\noc run kafka-producer -ti --image=strimzi/kafka:latest-kafka-2.4.0  --rm=true --restart=Never -- bin/kafka-console-producer.sh --broker-list my-cluster-kafka-bootstrap:9092 --topic test\n# enter text\n`}</code></pre>\n    <p>{`If you want to use the strimzi kafka docker image to run the above scripts locally but remotely connect to a kafka cluster you need multiple things to happen:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Be sure the kafka yaml file include the external route stamza:`}</li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`spec:\n  kafka:\n    version: 2.4.0\n    replicas: 3\n    listeners:\n      plain: {}\n      tls: {}\n      external:\n        type: route\n`}</code></pre>\n    <ul>\n      <li parentName=\"ul\">{`Get the host ip address from the Route resource`}</li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`oc get routes my-cluster-kafka-bootstrap -o=jsonpath='{.status.ingress[0].host}{\"\\\\n\"}'\n`}</code></pre>\n    <ul>\n      <li parentName=\"ul\">{`Get the TLS certificate from the broker`}</li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`oc get secrets\noc extract secret/my-cluster-cluster-ca-cert --keys=ca.crt --to=- > ca.crt\n# transform it fo java truststore\nkeytool -import -trustcacerts -alias root -file ca.crt -keystore truststore.jks -storepass password -noprompt\n`}</code></pre>\n    <ul>\n      <li parentName=\"ul\">{`Start the docker container by mounting the local folder with the truststore.jks to the `}<inlineCode parentName=\"li\">{`/home`}</inlineCode></li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`docker run -ti -v $(pwd):/home strimzi/kafka:latest-kafka-2.4.0  bash\n# inside the container uses the consumer tool\nbash-4.2$ cd /opt/kafka/bin\nbash-4.2$ ./kafka-console-consumer.sh --bootstrap-server  my-cluster-kafka-bootstrap-jb-kafka-strimzi.gse-eda-demos-fa9ee67c9ab6a7791435450358e564cc-0001.us-east.containers.appdomain.cloud:443 --consumer-property security.protocol=SSL --consumer-property ssl.truststore.password=password --consumer-property ssl.truststore.location=/home/truststore.jks --topic test --from-beginning\n`}</code></pre>\n    <ul>\n      <li parentName=\"ul\">{`For a producer the approach is the same but using the producer properties:`}</li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{}}>{`./kafka-console-producer.sh --broker-list  my-cluster-kafka-bootstrap-jb-kafka-strimzi.gse-eda-demos-fa9ee67c9ab6a7791435450358e564cc-0001.us-east.containers.appdomain.cloud:443 --producer-property security.protocol=SSL --producer-property ssl.truststore.password=password --producer-property ssl.truststore.location=/home/truststore.jks --topic test   \n`}</code></pre>\n    <p>{`Those properties can be in file`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`bootstrap.servers=my-cluster-kafka-bootstrap-jb-kafka-strimzi.gse-eda-demos-fa9ee67c9ab6a7791435450358e564cc-0001.us-east.containers.appdomain.cloud\nsecurity.protocol=SSL\nssl.truststore.password=password\nssl.truststore.location=/home/truststore.jks\n`}</code></pre>\n    <p>{`and then use the following parameters in the command line:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`./kafka-console-producer.sh --broker-list my-cluster-kafka-bootstrap-jb-kafka-strimzi.gse-eda-demos-fa9ee67c9ab6a7791435450358e564cc-0001.us-east.containers.appdomain.cloud:443 --producer.config /home/strimzi.properties --topic test\n\n./kafka-console-consumer.sh --bootstrap-server my-cluster-kafka-bootstrap-jb-kafka-strimzi.gse-eda-demos-fa9ee67c9ab6a7791435450358e564cc-0001.us-east.containers.appdomain.cloud:443  --topic test  --consumer.config /home/strimzi.properties --from-beginning \n`}</code></pre>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}