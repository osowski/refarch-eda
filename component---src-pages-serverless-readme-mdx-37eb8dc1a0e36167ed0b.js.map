{"version":3,"sources":["webpack:///./src/pages/serverless/README.mdx"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"mappings":"yeAMO,IAAMA,EAAe,GAOtBC,EAAc,CAClBD,gBAEIE,EAAYC,IACH,SAASC,EAAT,GAGZ,IAFDC,EAEC,EAFDA,WACGC,E,oIACF,mBACD,OAAO,YAACJ,EAAD,KAAeD,EAAiBK,EAAhC,CAAuCD,WAAYA,EAAYE,QAAQ,cAG5E,kCACA,mHACA,uBAAK,sBAAMC,WAAW,OAAU,IAA3B,8KAGL,iDACA,iFACA,mBAAU,CACR,UAAa,4BACb,MAAS,CACP,SAAY,WACZ,QAAW,QACX,WAAc,OACd,YAAe,OACf,SAAY,WAPhB,WAUI,sBAAMA,WAAW,QAAW,CAC5B,UAAa,qCACb,MAAS,CACP,cAAiB,qBACjB,SAAY,WACZ,OAAU,IACV,KAAQ,IACR,gBAAmB,gYACnB,eAAkB,QAClB,QAAW,YAnBjB,OAsBA,qBAAKA,WAAW,QAAW,CACvB,UAAa,0BACb,IAAO,UACP,MAAS,UACT,IAAO,iFACP,OAAU,CAAC,sFAAuF,sFAAuF,uFAAwF,uFAAwF,wFACzW,MAAS,oCACT,MAAS,CACP,MAAS,OACT,OAAU,OACV,OAAU,IACV,cAAiB,SACjB,SAAY,WACZ,IAAO,IACP,KAAQ,KAEV,QAAW,UAtCf,UAyCA,4CAA2B,0BAAYA,WAAW,KAAvB,YAA3B,iBACA,uBAAK,sBAAMA,WAAW,OAAU,IAA3B,wQAKL,kDACA,4DAA2C,mBAAGA,WAAW,KAAQ,CAC7D,KAAQ,oGAD+B,mBAA3C,iFAIA,uBAAK,sBAAMA,WAAW,OAAU,CAC5B,UAAa,qBADZ,yEAML,0DACA,uBAAK,sBAAMA,WAAW,OAAU,IAA3B,6UAKL,sDACA,uBAAK,sBAAMA,WAAW,OAAU,IAA3B,8BAEL,2BACA,uBAAK,sBAAMA,WAAW,OAAU,IAA3B,uLAIL,kFACA,uBAAK,sBAAMA,WAAW,OAAU,IAA3B,olCA0BL,uEACA,uBAAK,sBAAMA,WAAW,OAAU,IAA3B,4eAeL,sBACE,kBAAIA,WAAW,MAAf,wBAEF,uBAAK,sBAAMA,WAAW,OAAU,IAA3B,sBAEL,8CACA,6FACA,uBAAK,sBAAMA,WAAW,OAAU,IAA3B,uFAGL,mEACA,kEACA,2BAAU,mBAAGA,WAAW,KAAQ,CAC5B,KAAQ,2GADF,gBAAV,4HAGA,oCACA,sBACE,kBAAIA,WAAW,MAAK,mBAAGA,WAAW,MAAS,CACvC,KAAQ,sDADQ,yCAGpB,kBAAIA,WAAW,MAAK,mBAAGA,WAAW,MAAS,CACvC,KAAQ,4BADQ,wBAApB,iQAGA,kBAAIA,WAAW,MAAK,mBAAGA,WAAW,MAAS,CACvC,KAAQ,kCADQ,qBAGpB,kBAAIA,WAAW,MAAK,mBAAGA,WAAW,MAAS,CACvC,KAAQ,yCADQ,2CAGpB,kBAAIA,WAAW,MAAK,mBAAGA,WAAW,MAAS,CACvC,KAAQ,sCADQ,SAApB,8HAGA,kBAAIA,WAAW,MAAK,mBAAGA,WAAW,MAAS,CACvC,KAAQ,0EADQ,gDAGpB,kBAAIA,WAAW,MAAK,mBAAGA,WAAW,MAAS,CACvC,KAAQ,8DADQ,+BAQ1BJ,EAAWK,gBAAiB","file":"component---src-pages-serverless-readme-mdx-37eb8dc1a0e36167ed0b.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/refarch-eda/refarch-eda/docs-gatsby/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h2>{`Kubeless`}</h2>\n    <p>{`To install kubeless on ICP we first connect to the cluster and then use the command below:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ kubectl create namespace kubeless\n$ kubectl create -f https://github.com/kubeless/kubeless/releases/download/v1.0.0-alpha.8/kubeless-v1.0.0-alpha.8.yaml -n kubeless\n`}</code></pre>\n    <p>{`The image is using RBAC:`}</p>\n    <p>{`The deployment creates one pod with 3 containers inside:`}</p>\n    <span {...{\n      \"className\": \"gatsby-resp-image-wrapper\",\n      \"style\": {\n        \"position\": \"relative\",\n        \"display\": \"block\",\n        \"marginLeft\": \"auto\",\n        \"marginRight\": \"auto\",\n        \"maxWidth\": \"1152px\"\n      }\n    }}>{`\n      `}<span parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-background-image\",\n        \"style\": {\n          \"paddingBottom\": \"24.65277777777778%\",\n          \"position\": \"relative\",\n          \"bottom\": \"0\",\n          \"left\": \"0\",\n          \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAuElEQVQY042R4Q7CIAyEef+X9IfZdDI3WIGxATtbpjMxxkjy5Qppr1DU5AIGS7Ak6jAylnyNB0NVyUeUbcM/S/kwQxgm1nnhONT9mhJSykxCzhmlbMilVP2Fctw9LgmzEJ/KVHNmWfNxFuL6FfJyqQUuRCg9OrQ9QZsACruJJBl+dtv10IPB7b4jBX5ej2YvZCSWRyc5qmejU2vQaOKCd5LMtLlqnC+3atx2GmZytdmnoZzJX3T9iAdyWYQk9hvDGgAAAABJRU5ErkJggg==')\",\n          \"backgroundSize\": \"cover\",\n          \"display\": \"block\"\n        }\n      }}></span>{`\n  `}<img parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-image\",\n        \"alt\": \"drawing\",\n        \"title\": \"drawing\",\n        \"src\": \"/refarch-eda/static/4a39e53cfead4c2e9a5708a21bae254d/3cbba/kubeless-deploy.png\",\n        \"srcSet\": [\"/refarch-eda/static/4a39e53cfead4c2e9a5708a21bae254d/7fc1e/kubeless-deploy.png 288w\", \"/refarch-eda/static/4a39e53cfead4c2e9a5708a21bae254d/a5df1/kubeless-deploy.png 576w\", \"/refarch-eda/static/4a39e53cfead4c2e9a5708a21bae254d/3cbba/kubeless-deploy.png 1152w\", \"/refarch-eda/static/4a39e53cfead4c2e9a5708a21bae254d/0b124/kubeless-deploy.png 1728w\", \"/refarch-eda/static/4a39e53cfead4c2e9a5708a21bae254d/3f5bb/kubeless-deploy.png 2152w\"],\n        \"sizes\": \"(max-width: 1152px) 100vw, 1152px\",\n        \"style\": {\n          \"width\": \"100%\",\n          \"height\": \"100%\",\n          \"margin\": \"0\",\n          \"verticalAlign\": \"middle\",\n          \"position\": \"absolute\",\n          \"top\": \"0\",\n          \"left\": \"0\"\n        },\n        \"loading\": \"lazy\"\n      }}></img>{`\n    `}</span>\n    <p>{`We need to have the `}<inlineCode parentName=\"p\">{`kubeless`}</inlineCode>{` CLI install:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ export OS=$(uname -s| tr '[:upper:]' '[:lower:]')\n$ curl -OL https://github.com/kubeless/kubeless/releases/download/$RELEASE/kubeless_$OS-amd64.zip && \\\\\n  unzip kubeless_$OS-amd64.zip && \\\\\n  sudo mv bundles/kubeless_$OS-amd64/kubeless /usr/local/bin/\n`}</code></pre>\n    <h3>{`To deploy a simple hello`}</h3>\n    <p>{`The code for this function is under `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/ibm-cloud-architecture/refarch-cognitive-analytics/tree/master/src/functions\"\n      }}>{`this repository`}</a>{`\nbut it is a simple python function implementing the serverless ‘interface’:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-python3\"\n      }}>{`def hello(event, context):\n  print(event)\n  return event['data']\n`}</code></pre>\n    <p>{`To deploy we can use the command:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ kubeless function deploy hellojb --runtime python3.6  --trigger-http --from-file functionHello.py --handler functionHello.hello\nINFO[0000] Deploying function...                        \nINFO[0001] Function hellojb submitted for deployment    \nINFO[0001] Check the deployment status executing 'kubeless function ls hellojb'\n`}</code></pre>\n    <p>{`To see the functions deployed`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ kubectl get functions\n`}</code></pre>\n    <p>{`or`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ kubeless function ls\nNAME    NAMESPACE       HANDLER     RUNTIME     DEPENDENCIES    STATUS       \nhellojb greencompute    test.hello  python3.6                   1/1 READY\n`}</code></pre>\n    <p>{`The deployment of a function creates automatically a pod:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ kubectl describe pod hellojb\n...\nContainers:\n  hellojb:\n    Container ID:   docker://53ca1131747e5b18bfeb67609b4e7bb2400cf45202ade2c03274b9df1eff9bc2\n    Image:          kubeless/python@sha256:0c9f8f727d42625a4e25230cfe612df7488b65f283e7972f84108d87e7443d72\n    Image ID:       docker-pullable://kubeless/python@sha256:0c9f8f727d42625a4e25230cfe612df7488b65f283e7972f84108d87e7443d72\n    Port:           8080/TCP\n    Host Port:      0/TCP\n    State:          Running\n      Started:      Thu, 06 Sep 2018 17:12:52 -0700\n    Ready:          True\n    Restart Count:  0\n    Liveness:       http-get http://:8080/healthz delay=3s timeout=1s period=30s #success=1 #failure=3\n    Environment:\n      FUNC_HANDLER:       hello\n      MOD_NAME:           test\n      FUNC_TIMEOUT:       180\n      FUNC_RUNTIME:       python3.6\n      FUNC_MEMORY_LIMIT:  0\n      FUNC_PORT:          8080\n      PYTHONPATH:         /kubeless/lib/python3.6/site-packages:/kubeless\n    Mounts:\n      /kubeless from hellojb (rw)\n      /var/run/secrets/kubernetes.io/serviceaccount from default-token-9nw2z (ro)\n`}</code></pre>\n    <p>{`and kubeless create service for each function:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ kubectl describe svc hellojb\nName:              hellojb\nNamespace:         greencompute\nLabels:            created-by=kubeless\n                   function=hellojb\nAnnotations:       <none>\nSelector:          created-by=kubeless,function=hellojb\nType:              ClusterIP\nIP:                10.10.10.41\nPort:              http-function-port  8080/TCP\nTargetPort:        8080/TCP\nEndpoints:         192.168.130.101:8080\nSession Affinity:  None\nEvents:            <none>\n`}</code></pre>\n    <ul>\n      <li parentName=\"ul\">{`Remove the function`}</li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{}}>{`kubeless delete\n`}</code></pre>\n    <h3>{`Calling the function`}</h3>\n    <p>{`The quickest way is to proxy the server and then call the local URL:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`$ kubectl proxy -p 8080 &\n$ kubeless function call hellojb --data 'Hello Bill!'\n`}</code></pre>\n    <p>{`A second way is to test using HTTP client.`}</p>\n    <h2>{`Developing a predictive scoring function`}</h2>\n    <p>{`In `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/ibm-cloud-architecture/refarch-asset-analytics/tree/master/asset-predictive-scoring\"\n      }}>{`this project`}</a>{` we are addressing how to develop a scoring service using Python, sklearn and serveless to deploy the model as function.`}</p>\n    <h2>{`Compendium`}</h2>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://martinfowler.com/articles/serverless.html\"\n        }}>{`Excellent article from Martin Fowler`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://serverless.com/\"\n        }}>{`Serverless framework`}</a>{`: The Framework uses new event-driven compute services, like AWS Lambda, Google Cloud Functions, and more. It’s a command-line tool, providing scaffolding, workflow automation and best practices for developing and deploying your serverless architecture.`}</li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://openwhisk.apache.org/\"\n        }}>{`Apache OpenWhisk`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/claudiajs/claudia\"\n        }}>{`Claudia to deploy nodejs on AWS lambda`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/Miserlou/Zappa\"\n        }}>{`Zappa`}</a>{`: Zappa makes it super easy to build and deploy server-less, event-driven Python applications on AWS Lambda + API Gateway.`}</li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://charity.wtf/2016/05/31/operational-best-practices-serverless/\"\n        }}>{`Serverless conf: operational best practices`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"http://www.doc.ic.ac.uk/~rbc/papers/fse-serverless-17.pdf\"\n        }}>{`Evaluating cost for FaaS`}</a></li>\n    </ul>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}