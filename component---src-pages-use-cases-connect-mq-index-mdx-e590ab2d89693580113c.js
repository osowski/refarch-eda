(window.webpackJsonp=window.webpackJsonp||[]).push([[68,84],{"013z":function(e,t,n){"use strict";var a=n("q1tI"),o=n.n(a),c=n("NmYn"),r=n.n(c),s=n("Wbzz"),i=n("Xrax"),l=n("k4MR"),b=n("TSYQ"),m=n.n(b),p=n("QH2O"),d=n.n(p),u=n("qKvR"),g=function(e){var t,n=e.title,a=e.theme,o=e.tabs,c=void 0===o?[]:o;return Object(u.b)("div",{className:m()(d.a.pageHeader,(t={},t[d.a.withTabs]=c.length,t[d.a.darkMode]="dark"===a,t))},Object(u.b)("div",{className:"bx--grid"},Object(u.b)("div",{className:"bx--row"},Object(u.b)("div",{className:"bx--col-lg-12"},Object(u.b)("h1",{id:"page-title",className:d.a.text},n)))))},h=n("BAC9"),f=function(e){var t=e.relativePagePath,n=e.repository,a=Object(s.useStaticQuery)("1364590287").site.siteMetadata.repository,o=n||a,c=o.baseUrl,r=o.subDirectory,i=c+"/edit/"+o.branch+r+"/src/pages"+t;return c?Object(u.b)("div",{className:"bx--row "+h.row},Object(u.b)("div",{className:"bx--col"},Object(u.b)("a",{className:h.link,href:i},"Edit this page on GitHub"))):null},k=n("FCXl"),A=n("dI71"),O=n("I8xM"),N=function(e){function t(){return e.apply(this,arguments)||this}return Object(A.a)(t,e),t.prototype.render=function(){var e=this.props,t=e.title,n=e.tabs,a=e.slug,o=a.split("/").filter(Boolean).slice(-1)[0],c=n.map((function(e){var t,n=r()(e,{lower:!0,strict:!0}),c=n===o,i=new RegExp(o+"/?(#.*)?$"),l=a.replace(i,n);return Object(u.b)("li",{key:e,className:m()((t={},t[O.selectedItem]=c,t),O.listItem)},Object(u.b)(s.Link,{className:O.link,to:""+l},e))}));return Object(u.b)("div",{className:O.tabsContainer},Object(u.b)("div",{className:"bx--grid"},Object(u.b)("div",{className:"bx--row"},Object(u.b)("div",{className:"bx--col-lg-12 bx--col-no-gutter"},Object(u.b)("nav",{"aria-label":t},Object(u.b)("ul",{className:O.list},c))))))},t}(o.a.Component),v=n("MjG9"),j=n("CzIb"),y=n("Asxa"),C=n("OIbQ"),w=n.n(C),S=function(e){var t=e.date,n=new Date(t);return t?Object(u.b)(y.c,{className:w.a.row},Object(u.b)(y.a,null,Object(u.b)("div",{className:w.a.text},"Page last updated: ",n.toLocaleDateString("en-GB",{day:"2-digit",year:"numeric",month:"long"})))):null};t.a=function(e){var t=e.pageContext,n=e.children,a=e.location,o=e.Title,c=t.frontmatter,b=void 0===c?{}:c,m=t.relativePagePath,p=t.titleType,d=b.tabs,h=b.title,A=b.theme,O=b.description,y=b.keywords,C=b.date,w=Object(j.a)().interiorTheme,E=Object(s.useStaticQuery)("2456312558").site.pathPrefix,T=E?a.pathname.replace(E,""):a.pathname,q=d?T.split("/").filter(Boolean).slice(-1)[0]||r()(d[0],{lower:!0}):"",Q=A||w;return Object(u.b)(l.a,{tabs:d,homepage:!1,theme:Q,pageTitle:h,pageDescription:O,pageKeywords:y,titleType:p},Object(u.b)(g,{title:o?Object(u.b)(o,null):h,label:"label",tabs:d,theme:Q}),d&&Object(u.b)(N,{title:h,slug:T,tabs:d,currentTab:q}),Object(u.b)(v.a,{padded:!0},n,Object(u.b)(f,{relativePagePath:m}),Object(u.b)(S,{date:C})),Object(u.b)(k.a,{pageContext:t,location:a,slug:T,tabs:d,currentTab:q}),Object(u.b)(i.a,null))}},"4zw4":function(e,t,n){"use strict";n.r(t),n.d(t,"_frontmatter",(function(){return s})),n.d(t,"default",(function(){return u}));var a=n("wx14"),o=n("zLVn"),c=(n("q1tI"),n("7ljp")),r=n("013z"),s=(n("qKvR"),{}),i=function(e){return function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(c.b)("div",t)}},l=i("InlineNotification"),b=i("AnchorLinks"),m=i("AnchorLink"),p={_frontmatter:s},d=r.a;function u(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(c.b)(d,Object(a.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(c.b)(l,{kind:"warning",mdxType:"InlineNotification"},Object(c.b)("strong",null,"Work in progress")," - MQ Sink Connector on virtual or baremetal server, MQ and Event Streams on IBM Cloud not completed..."),Object(c.b)("p",null,"This scenario uses the ",Object(c.b)("a",{parentName:"p",href:"https://github.com/ibm-messaging/kafka-connect-mq-sink"},"IBM Kafka Connect sink connector for IBM MQ")," to pull streaming data into a MQ queue. We can have multiple deployment combinations but we will limit to two patterns:"),Object(c.b)(b,{mdxType:"AnchorLinks"},Object(c.b)(m,{mdxType:"AnchorLink"},"MQ Sink Connector, MQ, Kafka on OpenShift"),Object(c.b)(m,{mdxType:"AnchorLink"},"MQ Sink Connector on virtual or baremetal server, MQ and Event Streams on IBM Cloud")),Object(c.b)("h2",null,"Pre-requisites"),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Get a Git client")),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Clone the MQ Sink connector")," using the command:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-shell"},"git clone https://github.com/ibm-messaging/kafka-connect-mq-sink.git\n")),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"Clone the Lab repository")," to get configuration files. This lab is under ",Object(c.b)("a",{parentName:"p",href:"https://github.com/ibm-cloud-architecture/refarch-eda-tools/tree/master/labs/mq-sink-lab/"},"labs/mq-sink-lab/")," folder."),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-shell"},"git clone https://github.com/ibm-cloud-architecture/refarch-eda-tools.git\n")),Object(c.b)("h2",null,"MQ Sink Connector, MQ, Kafka on OpenShift"),Object(c.b)("p",null,"The target deployment looks like in the following diagram:"),Object(c.b)("p",null," ",Object(c.b)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(c.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"57.98611111111111%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACOklEQVQoz22TO2/UQBSF86sooECIPwAFNUKAUCgBifQU0AWIaKioAFGAgAohEFSggIgg74QobLIPe5+2x+PneD7ueJdko2DpaB46Pj733uMZEs0hEkj/A3d/hDfhTvGt21vLTKFzytxg8rJGnjoYimMoD1Bmwi3GqM95BXGMNYaZ7qhkuQk/tmFpB3YHFhWDEU5lBZPVncUAUWZZ3ofFDfi2CWstCFNqt2PBfsJmS7OxN0ajq4m1vHns+Xdn8EaaZk/Q1/hBTJwZbCwlO8FwqMhzLbbFcqHRcSQOK+JEnOoKnVZkuSXNqvr87ovm1ceQN58jXn9yCGn3qnEfnWDHi9gbGdbaOUv7BetNJe0wdEcViysZ39cyBoGpvfWEd+6mz6nLHc7Oepy+2qmxuFpAmVCVIvinpfiwVfL2V8qTrxnvV5S4NOLMSt8seWEpynG5gaq4cNvnxMUW52/5nLnW4eSllnx0SjAcqSOdytKUIDQk2WEfrR3v/aFhbmHIoxchj19G9eqw/LuEfCKoZESRilhdXZFSlfSrYBSUU4L2QLAnpd+YH3D/WcjD5yHzT0MWZP25LYJFOhYMZCjd/pDNrQa+H4iYIoxMPQA3iEQGkkhFSibf8UvmHgy4cqfH9Xt9Zu/2aqzvTjl0QQ4ld20Pmm3q6SaZlC4ikl+yxJBJFZ5X0dgp8Bo5pjwapMJlVE9iY5X0ULtfSVRTLXkSSLJtpGqS7XjYLUl9MHTqNc9xKuUQU0VxzSeK6tb8BQuzhLNsUwdXAAAAAElFTkSuQmCC')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(c.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"1",title:"1",src:"/refarch-eda/static/7f08c155d65695d6d8a840745ae86087/3cbba/all-ocp.png",srcSet:["/refarch-eda/static/7f08c155d65695d6d8a840745ae86087/7fc1e/all-ocp.png 288w","/refarch-eda/static/7f08c155d65695d6d8a840745ae86087/a5df1/all-ocp.png 576w","/refarch-eda/static/7f08c155d65695d6d8a840745ae86087/3cbba/all-ocp.png 1152w","/refarch-eda/static/7f08c155d65695d6d8a840745ae86087/12736/all-ocp.png 1206w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    ")),Object(c.b)("p",null,"Kafka is runnning in its own namespace, and we are using Event Streams from Cloud Pack for Integration."),Object(c.b)("h3",null,"Pre-requisites"),Object(c.b)("p",null,"We assume that you have an instance of Event Streams already running on OpenShift, with a TLS authentication user type. See ",Object(c.b)("a",{parentName:"p",href:"../../use-cases/overview/pre-requisites#getting-scram-authentication-from-event-streams-on-openshift"},"those instructions")," to get them."),Object(c.b)("p",null,"The MQ broker is running on OpenShift and was created using kubernetes operators: we have documented a simple how to guide in ",Object(c.b)("a",{parentName:"p",href:"../../technology/mq#installation-with-cloud-pak-for-integration"},"this MQ summary"),". The instance is exposed via a Route so we can access the administration console using the admin credentials of Cloud Pak for Integration."),Object(c.b)("h3",null,"Setup MQ Channel"),Object(c.b)("p",null,"Open a shell on the remote container or use the user interface to define the communication channel to use for the Kafka Connection."),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"Using CLI: Change the name of the Q manager to reflect what you defined in MQ configuration.")),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-shell"},"runmqsc EDAQMGR1\n# Define a app channel using server connection\nDEFINE CHANNEL(KAFKA.CHANNEL) CHLTYPE(SVRCONN)\n# Set the channel authentication rules to accept connections requiring userid and password\nSET CHLAUTH(KAFKA.CHANNEL) TYPE(BLOCKUSER) USERLIST('nobody')\nSET CHLAUTH('*') TYPE(ADDRESSMAP) ADDRESS('*') USERSRC(NOACCESS)\nSET CHLAUTH(KAFKA.CHANNEL) TYPE(ADDRESSMAP) ADDRESS('*') USERSRC(CHANNEL) CHCKCLNT(REQUIRED)\n# Set identity of the client connections\nALTER AUTHINFO(SYSTEM.DEFAULT.AUTHINFO.IDPWOS) AUTHTYPE(IDPWOS) ADOPTCTX(YES)\n\nREFRESH SECURITY TYPE(CONNAUTH)\n# Define inventory queue\nDEFINE QLOCAL(INVENTORY)\n# Authorize the IBM MQ user ID to connect to and inquire the queue manager\nSET AUTHREC OBJTYPE(QMGR) PRINCIPAL('admin') AUTHADD(CONNECT,INQ)\n# Authorize the IBM MQ user ID to use the queue:\nSET AUTHREC PROFILE(INVENTORY) OBJTYPE(QUEUE) PRINCIPAL('admin') AUTHADD(ALLMQI)\n# done\nEND\n")),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"As an alternate you can use the MQ administration console.")),Object(c.b)("p",null,"TBD"),Object(c.b)("h3",null,"Setup Kafka Connect Cluster"),Object(c.b)("p",null,"Connectors can be added to a Kafka Connect environment using OpenShift CLI commands and the source to image customer resource. We will use the Event Streams admin console to setup kafka connect environment which is based on OpenShift operator. The ",Object(c.b)("a",{parentName:"p",href:"https://ibm.github.io/event-streams/connecting/connectors/"},"Event Streams product documentation")," presents the deployment process within the admin console, the ",Object(c.b)("inlineCode",{parentName:"p"},"Setup a kafka connect environment")," tile guides developer thru those steps:"),Object(c.b)("p",null," ",Object(c.b)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"692px"}},"\n      ",Object(c.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"87.15277777777777%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACMklEQVQ4y6WUvY7TQBSF3VDSxREKRbJF2n0DHoOGhg4hxDPwBohnQNBAQcH24HhdINEtoBVCcf5w4ji7ycZ/Y489c5g7xDagDQriSp/GY4/O3HvnjI1ut4vBYIA8zzGfz7FarRDHMZIk2QtLE1xsEnwaJfg8TvBlx+IihtHr9bQgS2O4w2+YTKa4utogiiKEYbiXOA7BMwVrSJOQBI9wag8Qc2AdlQAkyrI8CF40FIosy2B0VYbOqRIsAH+L/wrOeVMyxVaVSuUwxiCE0FlUY8V1IaVsBDudDmzb1iLT6QyLxUL1caIPZ7lcIggC+L6voeeiKLRAs5GAUHpEToL9fh+O42j10WgEz/OU8LSG3rmui9lspuf0nZ4rILIm01IJHh8fa8EqZdqVsjhkpCxHAXDuSXydA8FGCbZaLViWpQVpwb8ElXnnicCtBwI37gk8O8lhtNvtWjBTfaQsD4V69u6M4+Qjx5sPHOdTBsM023BsC5epss1G1Kd2KOTbGqlKNlWG9sBCrrQ2YQ4pytoGf4tqjTrkmjznP0smH4qywNJfKHsssd1utY3SNNV3l24A3fVqTr2WuueyobKNaZrah1mWYzh0tUXIhzSOx2NtG4IsQ3N6vwp8yCKtct2hNij574dy3Sk3vWoiSgUmKwFvLfH9UurRW6uWRQcI/hrl7vNzdVNv3geOHkt0H0ncfihh3JV4+vYPQf2vU73bR5oylJxpe7y0GF47DK92vHjPcOYm+AG1H+NPXp6zYgAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(c.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"4",title:"4",src:"/refarch-eda/static/1bb44d11f13930a64b18447c097d8d97/b53e5/es-kconnect.png",srcSet:["/refarch-eda/static/1bb44d11f13930a64b18447c097d8d97/7fc1e/es-kconnect.png 288w","/refarch-eda/static/1bb44d11f13930a64b18447c097d8d97/a5df1/es-kconnect.png 576w","/refarch-eda/static/1bb44d11f13930a64b18447c097d8d97/b53e5/es-kconnect.png 692w"],sizes:"(max-width: 692px) 100vw, 692px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    ")),Object(c.b)("p",null," ",Object(c.b)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"803px"}},"\n      ",Object(c.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"95.4861111111111%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAABjUlEQVQ4y42UiarCQAxF+/8/KArivu/taBer8Z1AJI7zigOXZNLmNmuzsmolD41cLhfJ81wej4dwns+ndB2et237hSyEQq7X8Ier3G432Ww2Mp1OZblcynA4VH02m8lkMlHJfTwey3w+l6IoJISg0vTMLmbY7XayWCxktVqpExIbH0KC7XYr+/1e3/eAI/MXJI4QQUqUOBJ97Awokceb0CLEkYgGg8E7LYhJ1QN7fMdPU45rQDq8QHRGaNF26ZQiScgDXlqv151pp8qQTJkaWrqkg05n6TJAN5htNBrJ4XBQ/68IqQUk5nw8HrXg5/NZZ9UjbkhnyhAjuZOySfDT2JihaZqPjbjf7x/DGw9zbP8irKpKVwhig5/TlJ4k9F8mpdPppHVKOXYhi79I8ekYkmKXZak7/h/orCHZFMal1+tJv9/XjWF0bCb9SvrBth1P7jJpMou+syb9iJhOZNTZMkrW0DvT5V8O/9Fkl6mZybquVdJ5pNnsB2uw894UT4gDY0Nk9hdGN3AnmhQgfAH6DqsNPcehuAAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(c.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"5",title:"5",src:"/refarch-eda/static/ba93aa66417a294f6df7f194ec7bf9ce/644bd/es-kconn-setup.png",srcSet:["/refarch-eda/static/ba93aa66417a294f6df7f194ec7bf9ce/7fc1e/es-kconn-setup.png 288w","/refarch-eda/static/ba93aa66417a294f6df7f194ec7bf9ce/a5df1/es-kconn-setup.png 576w","/refarch-eda/static/ba93aa66417a294f6df7f194ec7bf9ce/644bd/es-kconn-setup.png 803w"],sizes:"(max-width: 803px) 100vw, 803px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    ")),Object(c.b)("p",null,"Once you downloaded the zip file, which is a yaml manifest, define the configuration for a KafkaConnectS2I instance. The major configuration settings are the server certificate settings and the authentication using Mutual TLS authentication, something like:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-yaml"},"spec:\n  bootstrapServers: sandbox-rp-kafka-bootstrap.eventstreams.svc:9093\n  tls:\n    trustedCertificates:\n    - secretName: sandbox-rp-cluster-ca-cert\n      certificate: ca.crt\n  authentication:\n    type: tls\n    certificate: user.crt\n    key: user.key\n    secretName: sandbox-rp-tls-cred\n")),Object(c.b)("p",null,"If you change the name of the connect cluster in the metadata, modify also the name: ",Object(c.b)("inlineCode",{parentName:"p"},"spec.template.pod.metadata.annotations. productChargedContainers")," accordingly."),Object(c.b)("p",null,"The secrets used above, need to be accessible from the project where the connector is deployed. The simple way to do so is to copy the source certificates from the Event streams project to your current project with the commands like:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-shell"},"oc get secret  sandbox-rp-cluster-ca-cert  -n eventstreams --export -o yaml | oc apply -f -\noc get secret  sandbox-rp-tls-cred  -n eventstreams --export -o yaml | oc apply -f -\n")),Object(c.b)("p",null,"If you do not have a TLS client certificate from a TLS user, use ",Object(c.b)("a",{parentName:"p",href:"../../overview/pre-requisites#getting-tls-authentication-from-event-streams-on-openshift"},"this note")," to create one."),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"Deploy the connector cluster")),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-shell"},"oc apply -f kafka-connect-s2i.yaml \n")),Object(c.b)("p",null,"An instance of this custom resource represents a Kafka Connect distributed worker cluster. In this mode, workload balancing is automatic, scaling is dynamic, and tasks and data are fault-tolerant. Each connector is represented by another custom resource called KafkaConnector."),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-shell"},"oc describe kafkaconnects2i eda-connect-cluster\n")),Object(c.b)("h3",null,"Add the mq-sink connector"),Object(c.b)("p",null,"The ",Object(c.b)("a",{parentName:"p",href:"https://ibm.github.io/event-streams/connecting/mq/"},"product documentation")," details the available MQ connectors and the configuration process. Using the event streams console, the process is quite simple to get a connector configuration as json file. Here is an example of the final form to generate the json file:"),Object(c.b)("p",null," ",Object(c.b)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"681px"}},"\n      ",Object(c.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"90.625%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAABkklEQVQ4y52UWY6CQBRF2f821MQlqDEOgCa6C9sEFREEilm5zX02pNODgh8nQFVxeEMVWq/Xw2w2w2Qy+cVoNMJ4PP5z7ifT6RT9fh/afD7H5XLBbreDZVnCfr/H8XhEEASI4xhFUSDP83/JsgxlWULXdWiLxQJhGOJ0OuF6vcq953nNPaH4Gb7vy4cZnAjv97sMJEkiV0qUUrK4lj6D6/guXdpqZcqg67oSOifSNO0MU5cIDWNVRRXBcRwRR1HUGWZDqQj1SsiCMlUOMsp3aCI0TVNk57MtxeXXusLMmhqy1WwKJ+oou0ARYZRfNTREZNu2SOtO1wtfwbWkEQ4GA3nghq6jfIdGOBwO5YGnpT4ZXWGnmy4zZQop48T3Dd4WZsYur9draMvlUuyHw6Hq9FmOHOVdtgzf59bbbrfQ+KdRKqpkDnw5lw/CULWG6/O8eAh13YDjF/iwXFh2AC8s4JIgb43jZ1BJic2mEvI/FkWxNIXXOE46o6ra3263R4Tc3WyCU9UvTRNBfhAtqRvIw0HhJ4+YTgmvZPX2AAAAAElFTkSuQmCC')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(c.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"6",title:"6",src:"/refarch-eda/static/a6a42bc9cb9e2ebc9badcde679b0bfa4/165d5/es-mq-sink.png",srcSet:["/refarch-eda/static/a6a42bc9cb9e2ebc9badcde679b0bfa4/7fc1e/es-mq-sink.png 288w","/refarch-eda/static/a6a42bc9cb9e2ebc9badcde679b0bfa4/a5df1/es-mq-sink.png 576w","/refarch-eda/static/a6a42bc9cb9e2ebc9badcde679b0bfa4/165d5/es-mq-sink.png 681w"],sizes:"(max-width: 681px) 100vw, 681px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    ")),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"Once the json is downloaded, complete the settings")),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "mq-sink",\n  "config":\n  {\n      "connector.class": "com.ibm.eventstreams.connect.mqsink.MQSinkConnector",\n      "tasks.max": "1",\n      "topics": "inventory",\n      "key.converter": "org.apache.kafka.connect.storage.StringConverter",\n      "value.converter": "org.apache.kafka.connect.storage.StringConverter",\n      "mq.queue.manager": "EDAQMGR1",\n      "mq.connection.name.list": "eda-mq-lab-ibm-mq(1414)",\n      "mq.user.name": "admin",\n      "mq.password": "passw0rd",\n      "mq.user.authentication.mqcsp": true,\n      "mq.channel.name": "KAFKA.CHANNEL",\n      "mq.queue": "INVENTORY",\n      "mq.message.builder": "com.ibm.eventstreams.connect.mqsink.builders.DefaultMessageBuilder"\n  }\n}\n')),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"To run the connector within the cluster, we need to connector jar. You can download this jar file from the Event Stream adming console ",Object(c.b)("inlineCode",{parentName:"p"},"> Toolkit > Add connector to your Kafka Connect environment > Add Connector > IBM MQ Connectors"),","),Object(c.b)("span",{parentName:"li",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"569px"}},"\n      ",Object(c.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"128.4722222222222%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsTAAALEwEAmpwYAAADgUlEQVRIx41VPa/jRBR9/4ECiY6C/0EB1YKACmiREA2iokaUKyEhqu13qZEQzVJBtbCsHuyikPc231+O45c4/ho7duzYhznXGSdZ3ntLpJP58Mydc+89c+csSRI4joPBYIB+vw/btjGfzzGdTjGbzRAEATabDbjuNsRxDKUUzjigkV6vh263K+1wOGzG/Oa6LlarlbQG6/W6Ace+74vRM/5xQFaG3WKxkL6t+5ZlCVOC3zzPEyOetz4xSk/EIGmyQxxciBFGdOF69yIVa9zgsukYRPsDLNvDcGzL6WIgUvqQ+ptz5WMytSUMSh327xmSnTGoWcoBOgxBpJORoNwVAHZAtZO2LAsEofYgDPUhkayPTg0eBkGocOVG4q7nx8i2OcK4Qs/awVru0Jnu9LiEitP9GoXlOmrc/Y9BT7MazHQWPaX7KVSSoz0q8ODnDA8fs18bDNVWr9nAckIMrfXeK3WclNpdxsmkn/NFkWNXVnD9BOsgQZ5n4I+6rPdEst7EsZGNYcmgB0EohglmL8tSiSUzH8cJ0jRrDpREhdGpQXa4kaca1DIwUqCcDvPHITpAncqGSjfipZCv9FV03ZXAW7ta0BYmk4nI5NjoAS+4TAm4LhXvQWkpXHQG+P3JM/z2x1949Pgp5rajY+VpFYQnGb0O4nKWZTo2KdKsDvp39+7jznsf4533P8Lbdz7E362O1t9OYnabsYbhaulgMR/jajHFUmM8HqPbY/UZoj8YiYCPmd3KsMwVfnik8NbXG3xwd4M3v0rx67MIRRpo4QbNpTd4KcNtqnDeTfDtTxnuPczwzY8ZWkN9SzaRyCgSeUQS5//FkPoazxyctyZ40prhn+djONr98WQqmR2NRlIfWXDDo6TcZPwMhcL9XzK88UWJ1z4r8e7dAlWupMK86OZ15eoYNUOWo6WP/lRjpsuS7Wv5uDp+vuiTBZVxNIWUV80U1JufAC3c7vN2jc4lLi8vcXFxgVarJa0Zt9vtpmUYlsulvEes8DykkQ2DTmGv5L04vBOGFTead4V9stxut3IdqV+2ZCwMje8mkwZGLlzMb4TaZ5xe5Xku9TLLalBizV3mZkOdrQHjR+NkQUa8UablXFnom1UZbKUiCUND2QTdgHN0k2yu+01WwPkA+HMIPB1V8MPkcJdf9quqqgGLrp7Bl99XeOWTEq9+WuH1z0t0Zgn+BZ7Gphu5+n0vAAAAAElFTkSuQmCC')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(c.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"es mq sink 1",title:"es mq sink 1",src:"/refarch-eda/static/666a96f7a21958a1b5f1f12c25ba5cf9/bded5/es-mq-sink-1.png",srcSet:["/refarch-eda/static/666a96f7a21958a1b5f1f12c25ba5cf9/7fc1e/es-mq-sink-1.png 288w","/refarch-eda/static/666a96f7a21958a1b5f1f12c25ba5cf9/bded5/es-mq-sink-1.png 569w"],sizes:"(max-width: 569px) 100vw, 569px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    "))),Object(c.b)("p",null,"or as an alternate, we ",Object(c.b)("a",{parentName:"p",href:"https://github.com/ibm-messaging/kafka-connect-mq-sink.git"},"cloned the mq-sink code"),", so a ",Object(c.b)("inlineCode",{parentName:"p"},"mvn package")," command under ",Object(c.b)("inlineCode",{parentName:"p"},"kafka-connect-mq-sink")," folder will build the jar. Copy this jar under ",Object(c.b)("inlineCode",{parentName:"p"},"cp4i/my-plugins")," folder. "),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"Build the connector with source to image component.")),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre"},"")),Object(c.b)("p",null,"With the correct credentials for IBM EventStreams and IBM MQ, Kafka Connect should connect to both services and pull data from the EventStreams topic configured to the MQ Queue configured.  You will see signs of success in the container output (via oc logs, or in the UI):"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-shell"},'+ curl -X POST -H Content-Type: application/json http://localhost:8083/connectors --data @/opt/kafka-connect-mq-sink/config/mq-sink.json\n...\n{"name":"mq-sink-connector","config":{"connector.class":"com.ibm.eventstreams.connect.mqsink.MQSinkConnector","tasks.max":"1","topics":"inventory","key.converter":"org.apache.kafka.connect.storage.StringConverter","value.converter":"org.apache.kafka.connect.storage.StringConverter","mq.queue.manager":"QM1","mq.connection.name.list":"mq-service(1414)","mq.user.name":"admin","mq.password":"passw0rd","mq.user.authentication.mqcsp":"true","mq.channel.name":"KAFKA.CHANNEL","mq.queue":"INVENTORY","mq.message.builder":"com.ibm.eventstreams.connect.mqsink.builders.DefaultMessageBuilder","name":"mq-sink-connector"},"tasks":[{"connector":"mq-sink-connector","task":0}],"type":"sink"}\n...\n[2020-06-23 04:26:26,054] INFO Creating task mq-sink-connector-0 (org.apache.kafka.connect.runtime.Worker:419)\n...[2020-06-23 04:26:26,449] INFO Connection to MQ established (com.ibm.eventstreams.connect.mqsink.JMSWriter:229)\n[2020-06-23 04:26:26,449] INFO WorkerSinkTask{id=mq-sink-connector-0} Sink task finished initialization and start (org.apache.kafka.connect.runtime.WorkerSinkTask:306)\n')),Object(c.b)("p",null,"You should now have the Kafka Connector MQ Sink running on OpenShift."),Object(c.b)("h2",null,"MQ Sink Connector on virtual or baremetal server, MQ and Event Streams on IBM Cloud"),Object(c.b)("p",null,"We are using our own laptop for the baremetal dedployment, but the current solution will work the same on virtual server."),Object(c.b)("p",null," ",Object(c.b)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(c.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"60.06944444444444%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACL0lEQVQoz1VTTW/TQBD1D+JHIPEf+AuIM0euHDggOHFBSCBAIHFCAnFA9ASC8tnQViJpadqSNGmbOHHstfd7H2/tuCQrjWZ2PPt23pt1EgK4ArwHrAO0dpDKwhgPbSz3Bs4336O19dGHZrO2kjaZZRUqUUKVJZySWHDfrPjd0tzS1sGiXwVO2rg/FtjoSrzZUXj+TaI7Ejg5s/jYUdhk7vO2xIetCulcNaBY7TCgDRPvHLS16J+W+HPucTgDfg4cxpnEk7cCl64OceX6GJevjRmfoNOt6k6d8xcdrlG2hhoxN8s1lJhhPOzXFJ1XePFO4Ma9FHeeZrj9OMPN+zPsDUzdkZAGKop+QXsFMManqcbBYYrt3SMc/c2Q8YKX70vcejjHo9cFHrzKcfdZhv2hrQ9ydsgqA+tXhxQBrYEh7XkRBwOcjIDzCbAQwCh12NnX+N6l9TQ6PYVKLql6h1Jb2NAOrmkxiYEyDoXkU2GBUryVvigtSvV/usYvPZ+SZK2N3gQYIgY+K46hpp5E1Kghu+ftgcBRHzReBZRVwKLwmCw8SuYkc0oH5KyZkkVaghdTdQKTaNOhJ3JJwOOJw9eew5eex4B0Cx6cZg6/9hS2SHeWO1TKYyYsfhwofNrV2PytcTzVNeUasBl7I2ouNFKKl2YColJ1LlLKRcDo1ONswriIOcecZI2kNJLMdF3rSDWxjap1l5wPnG0sasIHUHvNBvK8Mf5Ida6taetjraeW/wAeaJfpx7JhMAAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(c.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"2",title:"2",src:"/refarch-eda/static/9aeea9730df667cad9efd461136a4d76/3cbba/hybrid.png",srcSet:["/refarch-eda/static/9aeea9730df667cad9efd461136a4d76/7fc1e/hybrid.png 288w","/refarch-eda/static/9aeea9730df667cad9efd461136a4d76/a5df1/hybrid.png 576w","/refarch-eda/static/9aeea9730df667cad9efd461136a4d76/3cbba/hybrid.png 1152w","/refarch-eda/static/9aeea9730df667cad9efd461136a4d76/41dda/hybrid.png 1222w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    ")),Object(c.b)("h3",null,"Pre-requisites"),Object(c.b)("p",null,"We assume that you have an instance of Event Streams already running on IBM Cloud with at least on manager-level credentials created.  The credentials will come in the form of a JSON document as seen in the previous section.\nYou will need the ",Object(c.b)("inlineCode",{parentName:"p"},"kafka_brokers_sasl")," and ",Object(c.b)("inlineCode",{parentName:"p"},"password")," atribute to configure the sink connector."),Object(c.b)("p",null,"This scenario uses the ",Object(c.b)("inlineCode",{parentName:"p"},"inventory")," topic created in the Scenario Setup in previous section."),Object(c.b)("h3",null,"Create Local IBM MQ Instance"),Object(c.b)("p",null,"Here we will use Docker to create a local MQ instance.  First create a data directory to mount in the container."),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"mkdir qm1data")),Object(c.b)("p",null,"Then create the container."),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-shell"},"docker run                     \\\n  --name mq                    \\\n  --detach                     \\\n  --publish 1414:1414          \\\n  --publish 9443:9443          \\\n  --publish 9157:9157          \\\n  --volume qm1data:/mnt/mqm    \\\n  --env LICENSE=accept         \\\n  --env MQ_QMGR_NAME=QM1       \\\n  --env MQ_APP_PASSWORD=admin  \\\n  --env MQ_ENABLE_METRICS=true \\\n  ibmcom/mq\n")),Object(c.b)("p",null,"You should be able to log into the MQ server on port 9443 with default user ",Object(c.b)("inlineCode",{parentName:"p"},"admin")," and password ",Object(c.b)("inlineCode",{parentName:"p"},"passw0rd"),"."),Object(c.b)("p",null,"Connect to the running MQ instance to create a Channel and Queue as described on the ",Object(c.b)("a",{parentName:"p",href:"https://github.com/ibm-messaging/kafka-connect-mq-sink/blob/master/UsingMQwithKafkaConnect.md"},"Using IBM MQ with Kafka Connect")," page."),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-shell"},"docker exec -ti mq bash\nstrmqm QM1\nrunmqsc QM1\nDEFINE CHANNEL(KAFKA.CHANNEL) CHLTYPE(SVRCONN)\nSET CHLAUTH(KAFKA.CHANNEL) TYPE(BLOCKUSER) USERLIST('nobody')\nSET CHLAUTH('*') TYPE(ADDRESSMAP) ADDRESS('*') USERSRC(NOACCESS)\nSET CHLAUTH(KAFKA.CHANNEL) TYPE(ADDRESSMAP) ADDRESS('*') USERSRC(CHANNEL) CHCKCLNT(REQUIRED)\nALTER AUTHINFO(SYSTEM.DEFAULT.AUTHINFO.IDPWOS) AUTHTYPE(IDPWOS) ADOPTCTX(YES)\nREFRESH SECURITY TYPE(CONNAUTH)\nDEFINE QLOCAL(INVENTORY)\nSET AUTHREC OBJTYPE(QMGR) PRINCIPAL('admin') AUTHADD(CONNECT,INQ)\nSET AUTHREC PROFILE(INVENTORY) OBJTYPE(QUEUE) PRINCIPAL('admin') AUTHADD(ALLMQI)\nEND\n")),Object(c.b)("p",null,"Exit the session and continue on to create the MQ Connector Sink."),Object(c.b)("h3",null,"Create MQ Kafka Connector Sink"),Object(c.b)("p",null,"The MQ Connector Sink can be downloaded from ",Object(c.b)("a",{parentName:"p",href:"https://github.com/ibm-messaging/kafka-connect-mq-sink"},"Github"),".  The Github site includes exhaustive instructions and an abridged version follows."),Object(c.b)("p",null,"Clone the repository with the following command:"),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"git clone https://github.com/ibm-messaging/kafka-connect-mq-sink.git")),Object(c.b)("p",null,"Change directory into the kafka-connect-mq-sink directory:"),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"cd kafka-connect-mq-sink")),Object(c.b)("p",null,"Build the connector using Maven:"),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"mvn clean package")),Object(c.b)("p",null,"Next, create a directory to contain the Kafka Connector configuration."),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"mkdir config && cd config")),Object(c.b)("p",null,"Create a configuration file called ",Object(c.b)("inlineCode",{parentName:"p"},"connect-distributed.properties")," for Kafka Connect based on the template below."),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-properties"},'# A list of host/port pairs to use for establishing the initial connection to the Kafka cluster.\nbootstrap.servers=broker-1- ... kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-0- ... kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-4- ... kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-2- ... kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-5- ... kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-3- ... kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093\nssl.enabled.protocols=TLSv1.2\nssl.protocol=TLS\nsecurity.protocol=SASL_SSL\nsasl.mechanism=PLAIN\nsasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username="token" password="bA ... Qp";\n\n# Consumer side configuration\nconsumer.bootstrap.servers=broker-1- ... kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-0- ... kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-4- ... kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-2- ... kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-5- ... kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-3- ... kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093\nconsumer.security.protocol=SASL_SSL\nconsumer.ssl.protocol=TLSv1.2\nconsumer.sasl.mechanism=PLAIN\nconsumer.sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username="token" password="bA ... Qp";\n\n# Producer Side\nproducer.security.protocol=SASL_SSL\nproducer.ssl.protocol=TLSv1.2\nproducer.sasl.mechanism=PLAIN\nproducer.sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required username="token" password="bA ... Qp";\nproducer.bootstrap.servers=broker-1- ... kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-0- ... kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-4- ... kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-2- ... kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-5- ... kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-3- ... kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093\n\n\nplugin.path=/opt/kafka/libs\n\n# unique name for the cluster, used in forming the Connect cluster group. Note that this must not conflict with consumer group IDs\ngroup.id=mq-sink-cluster\n\n# The converters specify the format of data in Kafka and how to translate it into Connect data. Every Connect user will\n# need to configure these based on the format they want their data in when loaded from or stored into Kafka\nkey.converter=org.apache.kafka.connect.json.JsonConverter\nvalue.converter=org.apache.kafka.connect.json.JsonConverter\n# Converter-specific settings can be passed in by prefixing the Converter\'s setting with the converter we want to apply\n# it to\nkey.converter.schemas.enable=true\nvalue.converter.schemas.enable=true\n\n# Topic to use for storing offsets. T\noffset.storage.topic=connect-offsets\noffset.storage.replication.factor=3\n#offset.storage.partitions=25\n\n# Topic to use for storing connector and task configurations; note that this should be a single partition, highly replicated, and compacted topic.\nconfig.storage.topic=connect-configs\nconfig.storage.replication.factor=3\n\n# Topic to use for storing statuses. This topic can have multiple partitions and should be replicated and compacted.\nstatus.storage.topic=connect-status\nstatus.storage.replication.factor=3\nstatus.storage.partitions=5\n\n# Flush much faster than normal, which is useful for testing/debugging\noffset.flush.interval.ms=10000\n')),Object(c.b)("p",null,"Save this file in the ",Object(c.b)("inlineCode",{parentName:"p"},"config")," directory."),Object(c.b)("p",null,"Next, create a log4j configuration file named ",Object(c.b)("inlineCode",{parentName:"p"},"connect-log4j.properties")," based on the template below."),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-properties"},"log4j.rootLogger=DEBUG, stdout\n\nlog4j.appender.stdout=org.apache.log4j.ConsoleAppender\nlog4j.appender.stdout.layout=org.apache.log4j.PatternLayout\nlog4j.appender.stdout.layout.ConversionPattern=[%d] %p %m (%c:%L)%n\n\nlog4j.logger.org.apache.kafka=INFO\n")),Object(c.b)("p",null,"Save this file to the ",Object(c.b)("inlineCode",{parentName:"p"},"config")," directory as well."),Object(c.b)("p",null,"Finally, create a JSON configuraiton file for the MQ sink.  This can be stored anywhere but it can be conveniently created in the ",Object(c.b)("inlineCode",{parentName:"p"},"config")," directory.  We name this file ",Object(c.b)("inlineCode",{parentName:"p"},"mq-sink.json"),"."),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-json"},'{\n    "name": "mq-sink",\n    "config":\n    {\n        "connector.class": "com.ibm.eventstreams.connect.mqsink.MQSinkConnector",\n        "tasks.max": "1",\n        "topics": "inventory",\n\n        "key.converter": "org.apache.kafka.connect.storage.StringConverter",\n        "value.converter": "org.apache.kafka.connect.storage.StringConverter",\n\n        "mq.queue.manager": "QM1",\n        "mq.connection.name.list": "mq(1414)",\n        "mq.user.name": "admin",\n        "mq.password": "passw0rd",\n        "mq.user.authentication.mqcsp": true,\n        "mq.channel.name": "KAFKA.CHANNEL",\n        "mq.queue": "INVENTORY",\n        "mq.message.builder": "com.ibm.eventstreams.connect.mqsink.builders.DefaultMessageBuilder"\n    }\n}\n')),Object(c.b)("p",null,"Back out one directory to the ",Object(c.b)("inlineCode",{parentName:"p"},"kafka-connect-mq-sink")," directory."),Object(c.b)("p",null,Object(c.b)("inlineCode",{parentName:"p"},"cd ..")),Object(c.b)("p",null,"Build docker image\n",Object(c.b)("inlineCode",{parentName:"p"},"docker build -t kafkaconnect-with-mq-sink:1.3.0 .")),Object(c.b)("p",null,"Finally, run the Kafka Connect MQ Sink container."),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre"},"docker run                                 \\\n  --name mq-sink                           \\\n  --detach                                 \\\n  --volume $(pwd)/config:/opt/kafka/config \\\n  --publish 8083:8083                      \\\n  --link mq:mq                             \\\n  kafkaconnect-with-mq-sink:1.3.0\n")),Object(c.b)("p",null,"You should now have a working MQ sink."),Object(c.b)("p",null,"As an alternate approach, when you have a Kafka Connect isntance up and running, with the dependant jar files, it is possible to configure the connector with a POST operation like:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-Shell"},'curl -X POST -H "Content-Type: application/json" http://localhost:8083/connectors   --data "@./mq-sink.json"\n\n# The response returns the metadata about the connector\n{"name":"mq-sink","config":{"connector.class":"com.ibm.eventstreams.connect.mqsink.MQSinkConnector","tasks.max":"1","topics":"inventory","key.converter":"org.apache.kafka.connect.storage.StringConverter","value.converter":"org.apache.kafka.connect.storage.StringConverter","mq.queue.manager":"QM1","mq.connection.name.list":"ibmmq(1414)","mq.user.name":"admin","mq.password":"passw0rd","mq.user.authentication.mqcsp":"true","mq.channel.name":"KAFKA.CHANNEL","mq.queue":"INVENTORY","mq.message.builder":"com.ibm.eventstreams.connect.mqsink.builders.DefaultMessageBuilder","name":"mq-sink"},"tasks":[{"connector":"mq-sink","task":0}],"type":"sink"}\n')),Object(c.b)("p",null,"Once the connector is up and running, we can use some tool to send inventory message. In the ",Object(c.b)("inlineCode",{parentName:"p"},"integration-tests")," folder we have some python code to produce message. If you have a python environment with kafka api you can use yours, or we have also provided a Dockerfile to prepare a local python environment, which will not impact yours."),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-shell"},"# if you change the name of the image\ndocker build -t ibmcase/python37 .\n# ... then update the script ./startPython.sh\n./startPython.sh\n# Now in the new bash session you should see ProduceInventoryEvent.py,... start it by sending 2 events\npython ProduceInventoryEvent.py --size 2\n# Events are random but use stores and items known by the database downstream.\n sending -> {'storeName': 'NYC01', 'itemCode': 'IT06', 'quantity': 15, 'price': 163, 'id': 1, 'timestamp': '23-Jun-2020 04:32:38'}\n# the following trace demonstrates Kafka received the message\n[KafkaProducer] - Message delivered to inventory [0]\nsending -> {'storeName': 'SC01', 'itemCode': 'IT06', 'quantity': 15, 'price': 178, 'id': 2, 'timestamp': '23-Jun-2020 04:32:38'}\n[KafkaProducer] - Message delivered to inventory [0]\n")),Object(c.b)("p",null,"In the Kafka Connect trace we can see:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-shell"},"kconnect_1  | [2020-06-23 04:23:16,270] INFO WorkerSinkTask{id=mq-sink-0} Committing offsets asynchronously using sequence number 26: {inventory-0=OffsetAndMetadata{offset=44, leaderEpoch=null, metadata=''}} (org.apache.kafka.connect.runtime.WorkerSinkTask:349)\nkconnect_1  | [2020-06-23 04:32:46,382] INFO WorkerSinkTask{id=mq-sink-0} Committing offsets asynchronously using sequence number 83: {inventory-0=OffsetAndMetadata{offset=48, leaderEpoch=null, metadata=''}} (org.apache.kafka.connect.runtime.WorkerSinkTask:349)\n")),Object(c.b)("p",null,"And in the IBM MQ Console, under the Local Queue: Inventory we can see the messages:"),Object(c.b)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(c.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"43.75%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABIklEQVQoz5WSa26DMBCEOXWv08O0N2il/Og/8sIOELABv4DpjlXUNFKk1NInr63Z8e5Coese53OFpqmFJjPPM7jWdf03hbUGxhj0fQ9rLYZhQEopmz5LEmKa4UNAoS8XVFWFtm0RY8wC7s8SmJOi9BORokMxTWOubJqmXNmt+P78yOxqI953C0olhvv9Hhep8ng84nA4QCmF0+mUKcsSWuuHKKXR1gqfXxovr1e8fRgUbTfAWAcjM2TbnCErJjxztrds8yZd12V9DE5alg7DIB9lkjAAIXgRmT+t0nQcx5xEGHM02x3NqeOaV8A5j2L0EoRVDEMWcc/z+TkzeYNmGzzzQeq2X8Y5maExowQB3vssXJbl93eQSu+5v+fjzGUeDb8BC3C5EK2Bd2EAAAAASUVORK5CYII=')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(c.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"ibmq q inventory",title:"ibmq q inventory",src:"/refarch-eda/static/447c1faaa01eaff3324f6362e0215573/3cbba/ibmq-q-inventory.png",srcSet:["/refarch-eda/static/447c1faaa01eaff3324f6362e0215573/7fc1e/ibmq-q-inventory.png 288w","/refarch-eda/static/447c1faaa01eaff3324f6362e0215573/a5df1/ibmq-q-inventory.png 576w","/refarch-eda/static/447c1faaa01eaff3324f6362e0215573/3cbba/ibmq-q-inventory.png 1152w","/refarch-eda/static/447c1faaa01eaff3324f6362e0215573/e1971/ibmq-q-inventory.png 1256w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    "),Object(c.b)("p",null,"To remove the connector do the following command. Do this specially if you go to scenario 2 next."),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-shell"},"curl -X DELETE http://localhost:8083/connectors/mq-sink\n")))}u.isMDXComponent=!0},BAC9:function(e,t,n){e.exports={bxTextTruncateEnd:"EditLink-module--bx--text-truncate--end--2pqje",bxTextTruncateFront:"EditLink-module--bx--text-truncate--front--3_lIE",link:"EditLink-module--link--1qzW3",row:"EditLink-module--row--1B9Gk"}},I8xM:function(e,t,n){e.exports={bxTextTruncateEnd:"PageTabs-module--bx--text-truncate--end--267NA",bxTextTruncateFront:"PageTabs-module--bx--text-truncate--front--3xEQF",tabsContainer:"PageTabs-module--tabs-container--8N4k0",list:"PageTabs-module--list--3eFQc",listItem:"PageTabs-module--list-item--nUmtD",link:"PageTabs-module--link--1mDJ1",selectedItem:"PageTabs-module--selected-item--YPVr3"}},OIbQ:function(e,t,n){e.exports={bxTextTruncateEnd:"last-modified-date-module--bx--text-truncate--end--123zi",bxTextTruncateFront:"last-modified-date-module--bx--text-truncate--front--3xeKz",text:"last-modified-date-module--text--24m-4",row:"last-modified-date-module--row--2BquN"}},QH2O:function(e,t,n){e.exports={bxTextTruncateEnd:"PageHeader-module--bx--text-truncate--end--mZWeX",bxTextTruncateFront:"PageHeader-module--bx--text-truncate--front--3zvrI",pageHeader:"PageHeader-module--page-header--3hIan",darkMode:"PageHeader-module--dark-mode--hBrwL",withTabs:"PageHeader-module--with-tabs--3nKxA",text:"PageHeader-module--text--o9LFq"}}}]);
//# sourceMappingURL=component---src-pages-use-cases-connect-mq-index-mdx-e590ab2d89693580113c.js.map