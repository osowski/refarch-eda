(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{prNZ:function(e,t,a){"use strict";a.r(t),a.d(t,"_frontmatter",(function(){return s})),a.d(t,"default",(function(){return h}));var n=a("wx14"),r=a("zLVn"),o=(a("q1tI"),a("7ljp")),i=a("013z"),s=(a("qKvR"),{}),c=function(e){return function(t){return console.warn("Component '"+e+"' was not imported, exported, or provided by MDXProvider as global scope"),Object(o.b)("div",t)}},b=c("InlineNotification"),d=c("AnchorLinks"),p=c("AnchorLink"),l={_frontmatter:s},m=i.a;function h(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(o.b)(m,Object(n.a)({},l,a,{components:t,mdxType:"MDXLayout"}),Object(o.b)(b,{kind:"warning",mdxType:"InlineNotification"},Object(o.b)("strong",null,"TODO")," - Work in progress"),Object(o.b)(d,{mdxType:"AnchorLinks"},Object(o.b)(p,{mdxType:"AnchorLink"},"Pre-requisites"),Object(o.b)(p,{mdxType:"AnchorLink"},"Run the Kafka Connector in distributed mode"),Object(o.b)(p,{mdxType:"AnchorLink"},"Upload the DB2 sink definition"),Object(o.b)(p,{mdxType:"AnchorLink"},"Generate some records"),Object(o.b)(p,{mdxType:"AnchorLink"},"Verify records are uploaded into the Inventory database")),Object(o.b)("p",null,"This scenario is using the ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/ibm-messaging/kafka-connect-jdbc-sink"}),"IBM Kafka Connect sink connector for JDBC")," to get data from the ",Object(o.b)("inlineCode",{parentName:"p"},"inventory topic")," and write records to the ",Object(o.b)("inlineCode",{parentName:"p"},"inventory")," table in DB2. This lab explain the definition of the connector and how to run an integration test that sends data to the inventory topic."),Object(o.b)("h2",null,"Pre-requisites"),Object(o.b)(b,{kind:"warning",mdxType:"InlineNotification"},Object(o.b)("strong",null,"TODO")),Object(o.b)("p",null,Object(o.b)("em",{parentName:"p"},"Pull in necessary pre-req context from ",Object(o.b)("a",Object(n.a)({parentName:"em"},{href:"/refarch-eda/scenarios/realtime-inventory/#general-pre-requisites"}),"Realtime Inventory Pre-reqs"),".")),Object(o.b)("p",null,"As a pre-requisite you need to have a ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://cloud.ibm.com/docs/Db2onCloud?topic=Db2onCloud-getting-started"}),"DB2 instance on cloud")," up and running with defined credentials. From the credentials you need the username, password and the ",Object(o.b)("inlineCode",{parentName:"p"},"ssljdbcurl")," parameter. Something like “jdbc:db2://dashdb-tx…net:50001/BLUDB:sslConnection=true;“."),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Build and deploy the ",Object(o.b)("inlineCode",{parentName:"p"},"inventory-app"),". This application is a simple Java microprofile 3.3 app exposing a set of end points for cRUD operations on stores, items and inventory. It is based on ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https:quarkus.io"}),"Quarkus"),". The instructions to build, and deploy this app is in the ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/jbcodeforce/eda-kconnect-lab/tree/master/inventory-app"}),"README")," under the ",Object(o.b)("inlineCode",{parentName:"p"},"inventory-app")," folder of ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/jbcodeforce/eda-kconnect-lab"}),"this repository"),". At the application starts stores and items records are uploaded to the database.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Verify the stores and items records are loaded"))),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"If you deploy the ",Object(o.b)("inlineCode",{parentName:"p"},"inventory-app")," from previous step, then you will have the database created and populated with some stores and items automatically. If you want to drop the data use ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://raw.githubusercontent.com/jbcodeforce/eda-kconnect-lab/master/inventory-app/src/main/resources/drop.sql"}),"the drop sql script")," and then reload them the ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://raw.githubusercontent.com/jbcodeforce/eda-kconnect-lab/master/inventory-app/src/main/resources/import.sql"}),"insert sql script")," from ",Object(o.b)("inlineCode",{parentName:"p"},"inventory-app/src/main/resources")," folder. For that you can use the ",Object(o.b)("inlineCode",{parentName:"p"},"Run sql")," menu in the DB2 console:"),Object(o.b)("span",Object(n.a)({parentName:"li"},{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"574px"}}),"\n      ",Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"82.9861111111111%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACWklEQVQ4y6VS70tTYRS+IETSKiOzdCxszbaV6ea2LFMhNZcVZn0pQYroi31MZxZkc7W5VQpBEER/TdBf0IcRLHJtd679Xvt5d9+7+/S+76qP0daBh8N7Oee5z3POEbqHptBjm4bWPgOt7RI6jTYcOEHRN4R9egv2H7fw3GGwYq9+EJpjA+g0OXDIfOZXHkbXybM4aLTzGsHsegDLphe9M9ehHZiAzjoK5827GJudx8L9ZVyev4eJGwv827Xbi5i7swjD8CQOnzqHLuMg+q+uwHrrNexTs5ikdYJm/CI6rsyhnRbs7nVgl9aEntMj/I+mkWnoHRegs4xxMCLTeSfaj/ajrduItiMG7Okbh8bs5Gp1llEIa4G3eOJ9g/Wt93BvvcPqsxdwrQew4glgac2HZfcGXG4/x9LTDQofHj1/icfeVxSbtN6PVY8PDz2szw8BKnj8yOcgVSv43xCkYgWFQgG5XI7ner0Ooiio1WTU5OYhQFFRKpWQzWY5YSqZ4m8WdVWF2iQEKVngZGJMRDKVQjQaRT6f54RqK4QKbZSpPaWmgNQIFEItEwWSJDdsNwmBOkbmSxyRD0EkPn2D+PEz8tE0ZKXOSSWJNAVKqFKFhCtk6uSKDCIrLanjCkmhikwmg0g0glgshkQygZ14nM+DTrH5GZKShEqlws+GLaNYKPJtt7IQTqjSWTFCRsaIisUGISGE36RCb5LlfwU/G2aZ2c2kqfVIBKIocqJWTkdgTUq9oeJ3MLJWIVS/55FOpxEKhRAMBrH9dRtxuhT2ZkfOcjgcRrlc/qP4b/ETLR+K1oMHtqcAAAAASUVORK5CYII=')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(o.b)("img",Object(n.a)({parentName:"span"},{className:"gatsby-resp-image-image",alt:"DB1",title:"DB1",src:"/refarch-eda/static/2d4d80e816e3a178ffb05e7fb2149271/9f151/db2-1.png",srcSet:["/refarch-eda/static/2d4d80e816e3a178ffb05e7fb2149271/7fc1e/db2-1.png 288w","/refarch-eda/static/2d4d80e816e3a178ffb05e7fb2149271/9f151/db2-1.png 574w"],sizes:"(max-width: 574px) 100vw, 574px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    "),Object(o.b)("p",{parentName:"li"},"Select the database schema matching the username used as credential, and then open the SQL editor:"),Object(o.b)("span",Object(n.a)({parentName:"li"},{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"960px"}}),"\n      ",Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"52.77777777777778%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABbElEQVQoz4WSW0/DMAyF+/9/GU8IHhCPMDGJrsvWtUmcOLeD3V002DQiHTl1mq/HdruXt3c8Pb+CQsC91Vr7N6/7s7rIDPIBmTNaqai5oGqsFfLKckH3KaWLSimX/N8PdnqHzQy3GuDXO9iPDfyXAZkJ0R9d55zR9z367+8lzvO85EOIiJF/ueymzR40HEDbCU5iELjdjAjyrPvESYBFXIlLASucWZ3mBSgU1OuSx8kiSwmtHS9ooblkFHmuIj0L4kIBJACFEUXJRVjrb/rZsRykXEFJQLXJviBKi1JpCFmBFY/WGXZxGIhghWCogbjABcY+NNgE7KSikO9P86wbh0QeToA7Baa6AA8Cmq3DaAZshwHGmMtkb6G4ijg61NJmbmApj+W3cOIuSs8s6RSD9E8neXbRHragI+8wTIzV2GBswXBgrKeGwTV8Ss6GipgBzyptCx6qK0Wnl8TRKSkxnA4lDS/lu9hOwlW8rx8sxl6YoEML8AAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(o.b)("img",Object(n.a)({parentName:"span"},{className:"gatsby-resp-image-image",alt:"DB2",title:"DB2",src:"/refarch-eda/static/5ed9fa483ad840a441751caa25ddac91/4552c/db2-2.png",srcSet:["/refarch-eda/static/5ed9fa483ad840a441751caa25ddac91/7fc1e/db2-2.png 288w","/refarch-eda/static/5ed9fa483ad840a441751caa25ddac91/a5df1/db2-2.png 576w","/refarch-eda/static/5ed9fa483ad840a441751caa25ddac91/4552c/db2-2.png 960w"],sizes:"(max-width: 960px) 100vw, 960px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    "),Object(o.b)("p",{parentName:"li"},"Verify the items with ",Object(o.b)("inlineCode",{parentName:"p"},"select * from items;")),Object(o.b)("p",{parentName:"li"}," ",Object(o.b)("span",Object(n.a)({parentName:"p"},{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}}),"\n      ",Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"54.166666666666664%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABVUlEQVQoz3WSWY7EIAxEc/9TTmZairKvhC2Jh0cLmp+2ZAHGLpeXSq5HjkvLqFfZ113O85TjOLIiz/NETXfkvm9RSonWWuZ5FudctFcAqtvIoGZZl1W00bLvu6zrKtu2ZbASFLmuKyYEdJqmD2Bw+zjtRh7j5ZsQNI5jrAJA1Dsv7tDhfod/HxgCFOhvwyzLXydj3YjelDjvIkBS770YYzJgYmeNjWVba6NflTIP/SDTMMrvTy3qUDGoVIIAqetalmWRtm1jqQCRiH/83gwDXYynfgffz51LSsoQSExfudNngAFNrLFXaWJkSiy+CcAMC8EPQN7zVE45iLVk3vN0+SRBqdhICBtO/Pq+jwxhTYW5hyY0dgpZ+MQp9aRUbAyhaZrIjh6+Xq948oYMmktOIASVy1zuX9o93uXys9ip/Lw2NJXpQv8bIKtDFbwB6LouMkRJhvwDGxRYufItiB0AAAAASUVORK5CYII=')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(o.b)("img",Object(n.a)({parentName:"span"},{className:"gatsby-resp-image-image",alt:"DB2",title:"DB2",src:"/refarch-eda/static/a769df08d731b8e9040cafb444d06da7/3cbba/db2-3.png",srcSet:["/refarch-eda/static/a769df08d731b8e9040cafb444d06da7/7fc1e/db2-3.png 288w","/refarch-eda/static/a769df08d731b8e9040cafb444d06da7/a5df1/db2-3.png 576w","/refarch-eda/static/a769df08d731b8e9040cafb444d06da7/3cbba/db2-3.png 1152w","/refarch-eda/static/a769df08d731b8e9040cafb444d06da7/e3892/db2-3.png 1186w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    ")),Object(o.b)("p",{parentName:"li"},"Verify the stores with ",Object(o.b)("inlineCode",{parentName:"p"},"select * from stores;")),Object(o.b)("span",Object(n.a)({parentName:"li"},{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}}),"\n      ",Object(o.b)("span",Object(n.a)({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"47.56944444444444%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABNElEQVQoz32SiW6DMBBE+f+/jNQmCgQCGB9gYOrnxhGKSi1WPpjdnRm7GlarwRnZySqEoGmaZK3Nse+7ymBd9uu6ynsv55zGcdS2bW9M1W9WzdhqGAY57/R8PvO67/t3gWNhxrIsMsbkAEeDd8HflukzQXuIOhswejweeY4x5uS4REUXtCaGS1pTuOKnqTv1X7X670bBei3pDBYlwGAHNjDP85ylInlKLDkHh/TKudS5btSkYJ5TAsC/AnYEBS6XS7bnfr/rer3mRrlgjGtmAKht2+wJP6B/FuDBwZS8cp49LMl05jIwuph8NkgEW/KOl1eFl0QAmI4EisICBp+BV+Sgpjyb7Gvx0OZDo67rdLvdVNe1TNoDKp59BjLB0pjC7L1/eVj0A6To8U39J7lYA8vtkPMD6AIMXP0i7A0AAAAASUVORK5CYII=')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(o.b)("img",Object(n.a)({parentName:"span"},{className:"gatsby-resp-image-image",alt:"DB2",title:"DB2",src:"/refarch-eda/static/d56157f8db1b9bf3d5003babec4b9453/3cbba/db2-4.png",srcSet:["/refarch-eda/static/d56157f8db1b9bf3d5003babec4b9453/7fc1e/db2-4.png 288w","/refarch-eda/static/d56157f8db1b9bf3d5003babec4b9453/a5df1/db2-4.png 576w","/refarch-eda/static/d56157f8db1b9bf3d5003babec4b9453/3cbba/db2-4.png 1152w","/refarch-eda/static/d56157f8db1b9bf3d5003babec4b9453/bed59/db2-4.png 1232w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    "),Object(o.b)("p",{parentName:"li"},"The inventory has one record to illustrate the relationship between store, item and inventory."))),Object(o.b)("h2",null,"Run the Kafka Connector in distributed mode"),Object(o.b)("p",null,"The docker image built in the ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"#scenario-setup"}),"setup")," has the configuration for kafka connect distributed cluster, we need in this scenario to start the connector and upload the DB2 Sink connector definition. To start it, run the script ",Object(o.b)("inlineCode",{parentName:"p"},"./createOrStartKconnect.sh start")," under ",Object(o.b)("inlineCode",{parentName:"p"},"kconnect")," folder."),Object(o.b)("h2",null,"Upload the DB2 sink definition"),Object(o.b)("p",null,"Rename the file ",Object(o.b)("inlineCode",{parentName:"p"},"db2-sink-config-TMPL.json")," as ",Object(o.b)("inlineCode",{parentName:"p"},"db2-sink-config.json")," and modify the DB2 server URL, DB2 username and password. The DB schema matches the user name, so update this setting for the ",Object(o.b)("inlineCode",{parentName:"p"},"table.name.format"),"."),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),'  "name": "jdbc-sink-connector",\n  "config": {\n    "connector.class": "com.ibm.eventstreams.connect.jdbcsink.JDBCSinkConnector",\n    "tasks.max": "1",\n    "topics": "inventory",\n    "connection.url": "jdbc:db2://....services.dal.bluemix.net:50001/BLUDB:sslConnection=true;",\n    "connection.user": "<username>",\n    "connection.password": "<password>",\n    "connection.ds.pool.size": "1",\n    "insert.mode.databaselevel": "true",\n    "table.name.format": "<username>.INVENTORY"\n  }\n')),Object(o.b)("p",null,"Once done, you can run the ",Object(o.b)("inlineCode",{parentName:"p"},"./sendJdbcSinkConfig.sh url-kafka-connect")," to upload the above definition to the Kafka connect controller. When running locally the command is ",Object(o.b)("inlineCode",{parentName:"p"},"./sendJdbcSinkConfig.sh localhodt:8083"),". This script delete previously define connector with the same name, and then perform a POST operation on the ",Object(o.b)("inlineCode",{parentName:"p"},"/connectors")," end point."),Object(o.b)("p",null,"The connector trace should have something like:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-logs"}),"connector.class = com.ibm.eventstreams.connect.jdbcsink.JDBCSinkConnector\n    errors.log.enable = false\n    errors.log.include.messages = false\n    errors.retry.delay.max.ms = 60000\n    errors.retry.timeout = 0\n    errors.tolerance = none\n    header.converter = null\n    key.converter = null\n    name = jdbc-sink-connector\n    tasks.max = 1\n    transforms = []\n    value.converter = null\n\n")),Object(o.b)("h2",null,"Generate some records"),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"integration-tests")," folder includes a set of python code to load some records to the expected topic."),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Start a python environment with ",Object(o.b)("inlineCode",{parentName:"li"},"./startPython.sh")),Object(o.b)("li",{parentName:"ol"},"Within the bash, start python to execute the  ",Object(o.b)("inlineCode",{parentName:"li"},"ProduceInventoryEvent.py")," script, and specify the number of records to send via the —size argument.")),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{}),"python ProduceInventoryEvent.py --size 2\n")),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"The trace should have something like")),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{}),"Produce to the topic inventory\n[KafkaProducer] - This is the configuration for the producer:\n[KafkaProducer] - {'bootstrap.servers': 'broker-0-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-1-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-2-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-3-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-4-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093,broker-5-qnprtqnp7hnkssdz.kafka.svc01.us-east.eventstreams.cloud.ibm.com:9093', 'group.id': 'ProducerInventory', 'acks': 0, 'request.timeout.ms': 10000, 'security.protocol': 'SASL_SSL', 'sasl.mechanisms': 'PLAIN', 'sasl.username': 'token', 'sasl.password': 'am_rbb9e794mMwhE-KGPYo0hhW3h91e28OhT8IlruFe5'}\nsending -> {'storeName': 'LA02', 'itemCode': 'IT09', 'id': 0, 'timestamp': 1591211295.617515}\n[KafkaProducer] - Message delivered to inventory [0]\nsending -> {'storeName': 'PT02', 'itemCode': 'IT00', 'id': 1, 'timestamp': 1591211296.7727954}\n[KafkaProducer] - Message delivered to inventory [0]\n\n")),Object(o.b)("h2",null,"Verify records are uploaded into the Inventory database"),Object(o.b)("p",null,"Using the DB2 console, use the ",Object(o.b)("inlineCode",{parentName:"p"},"select * from inventory;")," SQL query to get the last records."))}h.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-use-cases-connect-jdbc-index-mdx-51036d4aba6771698c90.js.map