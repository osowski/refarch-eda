(window.webpackJsonp=window.webpackJsonp||[]).push([[81,99],{"013z":function(e,t,a){"use strict";var n=a("q1tI"),r=a.n(n),o=a("NmYn"),c=a.n(o),i=a("Wbzz"),s=a("Xrax"),b=a("k4MR"),l=a("TSYQ"),m=a.n(l),p=a("QH2O"),d=a.n(p),u=a("qKvR"),g=function(e){var t,a=e.title,n=e.theme,r=e.tabs,o=void 0===r?[]:r;return Object(u.b)("div",{className:m()(d.a.pageHeader,(t={},t[d.a.withTabs]=o.length,t[d.a.darkMode]="dark"===n,t))},Object(u.b)("div",{className:"bx--grid"},Object(u.b)("div",{className:"bx--row"},Object(u.b)("div",{className:"bx--col-lg-12"},Object(u.b)("h1",{id:"page-title",className:d.a.text},a)))))},h=a("BAC9"),f=function(e){var t=e.relativePagePath,a=e.repository,n=Object(i.useStaticQuery)("1364590287").site.siteMetadata.repository,r=a||n,o=r.baseUrl,c=r.subDirectory,s=o+"/edit/"+r.branch+c+"/src/pages"+t;return o?Object(u.b)("div",{className:"bx--row "+h.row},Object(u.b)("div",{className:"bx--col"},Object(u.b)("a",{className:h.link,href:s},"Edit this page on GitHub"))):null},j=a("FCXl"),A=a("dI71"),O=a("I8xM"),N=function(e){function t(){return e.apply(this,arguments)||this}return Object(A.a)(t,e),t.prototype.render=function(){var e=this.props,t=e.title,a=e.tabs,n=e.slug,r=n.split("/").filter(Boolean).slice(-1)[0],o=a.map((function(e){var t,a=c()(e,{lower:!0,strict:!0}),o=a===r,s=new RegExp(r+"/?(#.*)?$"),b=n.replace(s,a);return Object(u.b)("li",{key:e,className:m()((t={},t[O.selectedItem]=o,t),O.listItem)},Object(u.b)(i.Link,{className:O.link,to:""+b},e))}));return Object(u.b)("div",{className:O.tabsContainer},Object(u.b)("div",{className:"bx--grid"},Object(u.b)("div",{className:"bx--row"},Object(u.b)("div",{className:"bx--col-lg-12 bx--col-no-gutter"},Object(u.b)("nav",{"aria-label":t},Object(u.b)("ul",{className:O.list},o))))))},t}(r.a.Component),k=a("MjG9"),y=a("CzIb"),w=a("Asxa"),v=a("OIbQ"),x=a.n(v),q=function(e){var t=e.date,a=new Date(t);return t?Object(u.b)(w.c,{className:x.a.row},Object(u.b)(w.a,null,Object(u.b)("div",{className:x.a.text},"Page last updated: ",a.toLocaleDateString("en-GB",{day:"2-digit",year:"numeric",month:"long"})))):null};t.a=function(e){var t=e.pageContext,a=e.children,n=e.location,r=e.Title,o=t.frontmatter,l=void 0===o?{}:o,m=t.relativePagePath,p=t.titleType,d=l.tabs,h=l.title,A=l.theme,O=l.description,w=l.keywords,v=l.date,x=Object(y.a)().interiorTheme,T=Object(i.useStaticQuery)("2456312558").site.pathPrefix,R=T?n.pathname.replace(T,""):n.pathname,C=d?R.split("/").filter(Boolean).slice(-1)[0]||c()(d[0],{lower:!0}):"",Q=A||x;return Object(u.b)(b.a,{tabs:d,homepage:!1,theme:Q,pageTitle:h,pageDescription:O,pageKeywords:w,titleType:p},Object(u.b)(g,{title:r?Object(u.b)(r,null):h,label:"label",tabs:d,theme:Q}),d&&Object(u.b)(N,{title:h,slug:R,tabs:d,currentTab:C}),Object(u.b)(k.a,{padded:!0},a,Object(u.b)(f,{relativePagePath:m}),Object(u.b)(q,{date:v})),Object(u.b)(j.a,{pageContext:t,location:n,slug:R,tabs:d,currentTab:C}),Object(u.b)(s.a,null))}},BAC9:function(e,t,a){e.exports={bxTextTruncateEnd:"EditLink-module--bx--text-truncate--end--2pqje",bxTextTruncateFront:"EditLink-module--bx--text-truncate--front--3_lIE",link:"EditLink-module--link--1qzW3",row:"EditLink-module--row--1B9Gk"}},I8xM:function(e,t,a){e.exports={bxTextTruncateEnd:"PageTabs-module--bx--text-truncate--end--267NA",bxTextTruncateFront:"PageTabs-module--bx--text-truncate--front--3xEQF",tabsContainer:"PageTabs-module--tabs-container--8N4k0",list:"PageTabs-module--list--3eFQc",listItem:"PageTabs-module--list-item--nUmtD",link:"PageTabs-module--link--1mDJ1",selectedItem:"PageTabs-module--selected-item--YPVr3"}},OIbQ:function(e,t,a){e.exports={bxTextTruncateEnd:"last-modified-date-module--bx--text-truncate--end--123zi",bxTextTruncateFront:"last-modified-date-module--bx--text-truncate--front--3xeKz",text:"last-modified-date-module--text--24m-4",row:"last-modified-date-module--row--2BquN"}},QH2O:function(e,t,a){e.exports={bxTextTruncateEnd:"PageHeader-module--bx--text-truncate--end--mZWeX",bxTextTruncateFront:"PageHeader-module--bx--text-truncate--front--3zvrI",pageHeader:"PageHeader-module--page-header--3hIan",darkMode:"PageHeader-module--dark-mode--hBrwL",withTabs:"PageHeader-module--with-tabs--3nKxA",text:"PageHeader-module--text--o9LFq"}},rBpE:function(e,t,a){"use strict";a.r(t),a.d(t,"_frontmatter",(function(){return i})),a.d(t,"default",(function(){return u}));var n=a("wx14"),r=a("zLVn"),o=(a("q1tI"),a("7ljp")),c=a("013z"),i=(a("qKvR"),{}),s=function(e){return function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(o.b)("div",t)}},b=s("InlineNotification"),l=s("AnchorLinks"),m=s("AnchorLink"),p={_frontmatter:i},d=c.a;function u(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(o.b)(d,Object(n.a)({},p,a,{components:t,mdxType:"MDXLayout"}),Object(o.b)(b,{kind:"warning",mdxType:"InlineNotification"},Object(o.b)("strong",null,"Updated 11/10/2020")," Lab completed on local computer. Instruction not completed for OpenShift deployment."),Object(o.b)(l,{mdxType:"AnchorLinks"},Object(o.b)(m,{mdxType:"AnchorLink"},"Just run it!"),Object(o.b)(m,{mdxType:"AnchorLink"},"Deploy on OpenShift")),Object(o.b)("p",null,"This hands-on lab demonstrates how to use IBM RabbitMQ Kafka source connector to inject message to Event Streams On Premise or any Kafka cluster.\nWe are using the ",Object(o.b)("a",{parentName:"p",href:"https://github.com/ibm-messaging/kafka-connect-rabbitmq-source"},"IBM messaging github: source Kafka connector for RabbitMQ")," open sourced component. The configuration for this connector is also done using Json config file, with a POST to the Kafka connectors URL."),Object(o.b)("p",null,"The following diagram illustrates the component of this demo / lab:"),Object(o.b)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"696px"}},"\n      ",Object(o.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"54.166666666666664%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABw0lEQVQoz41SS27bMBT0WXuJHqNFN90UuUELL1ogQFF0kWwSG43TRZzYbmL9LNl1rL9EkxSn71GWIO9KYEC+x5nhkNLIlCVQV2jKCnVcQWUVRFLZnkXFeyV00cJQ3QGDtcXxiJGREjwaA2gFHBKgYK8jcKRaaYPh0ERsjKG5QbfTz3VNhuTKI8klbucHGyrPG0jRkrZ7gctpiM9XPr7/Cnt1Q4YMkLkhwDTnhmkpcffngIYSCQo9XRT4cu1htozxbjzH24t7vB8/WnGbULeGXTo2ZkOQ4fBSkovXFcbfpnjz4Tee3NT2RU1ijR5KtglNn9CcJ7Qnn06U6V/MJxN4/oF5rZCwjWv8nG3x4y7C3Mns6/W6oSGHMoPTNO2X9GXV6SGlUla8jjJ8/PqIT5crTBZ7u5dlOYQQgytrjf8dSmn6U+qzXhiG1Kvagg1fowh+EGCz2SAYgHsMx3Hg+D7WNAdUR8Rnbsff7XYIqRfSWtOtRjsiOy8v8NZrC/c0bzwPvuti8fCA5e0Nnu5ncKgfUN8j847nkpbhU08VBUZFHKNKkh51miLf7+GuVgjZmE2WS/hUByx8fkZCqZg31JXkI+jK/wATikfDB/R0twAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(o.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"0",title:"0",src:"/refarch-eda/static/414eac07528673a0df069d9bdf8ea778/19b24/comp-view.png",srcSet:["/refarch-eda/static/414eac07528673a0df069d9bdf8ea778/7fc1e/comp-view.png 288w","/refarch-eda/static/414eac07528673a0df069d9bdf8ea778/a5df1/comp-view.png 576w","/refarch-eda/static/414eac07528673a0df069d9bdf8ea778/19b24/comp-view.png 696w"],sizes:"(max-width: 696px) 100vw, 696px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    "),Object(o.b)("p",null,"The configurations used in this use case are in the ",Object(o.b)("inlineCode",{parentName:"p"},"refarch-eda-tools")," repository that you should clone:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-shell"},"git clone https://github.com/ibm-cloud-architecture/refarch-eda-tools\n")),Object(o.b)("p",null,"under the ",Object(o.b)("a",{parentName:"p",href:"https://github.com/ibm-cloud-architecture/refarch-eda-tools/tree/master/labs/rabbitmq-source-lab"},"labs/rabbitmq-source-lab")," folder."),Object(o.b)("h2",null,"Just run it!"),Object(o.b)("p",null,"For demonstration purpose, we have defined a docker compose file and a set of docker images ready to use. So it will be easier to demonstrate the scenario of sending messages to Rabbit MQ ",Object(o.b)("inlineCode",{parentName:"p"},"items")," queue, have a Kafka connector configured and a simple Kafka consumer which consumes Json doc from the ",Object(o.b)("inlineCode",{parentName:"p"},"items")," Kafka topic. "),Object(o.b)("p",null,"To send message to RabbitMQ, we have implemented a simple store sale simulator, which sends item sale messages for a set of stores. The code is under ",Object(o.b)("a",{parentName:"p",href:"https://github.com/ibm-cloud-architecture/refarch-eda-store-simulator"},"eda-store-simulator repository")," and we have also uploaded the image ",Object(o.b)("a",{parentName:"p",href:"https://hub.docker.com/repository/docker/ibmcase/eda-store-simulator"},"into dockerhub ibmcase/eda-store-simulator"),"."),Object(o.b)("h3",null,"Start backend services"),Object(o.b)("p",null,"To quickly start a local demonstration environment, the ",Object(o.b)("a",{parentName:"p",href:"https://github.com/ibm-cloud-architecture/refarch-eda-tools"},"github repository for this lab")," includes a ",Object(o.b)("a",{parentName:"p",href:"https://github.com/ibm-cloud-architecture/refarch-eda-tools/tree/master/labs/rabbitmq-source-lab/docker-compose.yaml"},"docker compose file")," under the ",Object(o.b)("inlineCode",{parentName:"p"},"labs/rabbitmq-source-lab")," folder."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-shell"},"git clone https://github.com/ibm-cloud-architecture/refarch-eda-tools\ncd refarch-eda-tools/labs/rabbitmq-source-lab\ndocker-compose up -d\ndocker ps \n\nIMAGE                              NAMES                            PORT                  \nibmcase/kconnect:v1.0.0            rabbitmq-source-lab_kconnect_1   0.0.0.0:8083->8083/  \nstrimzi/kafka:latest-kafka-2.6.0   rabbitmq-source-lab_kafka_1      0.0.0.0:9092->9092/\nibmcase/eda-store-simulator        rabbitmq-source-lab_simulator_1  0.0.0.0:8080->8080/\nrabbitmq:3-management              rabbitmq-source-lab_rabbitmq_1   0.0.0.0:5672->5672/tcp, 15671/tcp, 15691-15692/tcp, 25672/tcp, 0.0.0.0:15672->15672/tcp   \nstrimzi/kafka:latest-kafka-2.6.0   rabbitmq-source-lab_zookeeper_1 0.0.0.0:2181->2181/                                                                                      \n")),Object(o.b)("h3",null,"Deploy source connector"),Object(o.b)("p",null,"Once the different containers are started, you can deploy the RabbitMQ source connector using the following POST"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-shell"},'# under the folder use the curl to post configuration\n./sendRMQSrcConfig.sh localhost:8083\n\n# Trace should look like\n{"name":"RabbitMQSourceConnector",\n"config":{"connector.class":"com.ibm.eventstreams.connect.rabbitmqsource.RabbitMQSourceConnector",\n"tasks.max":"1",\n"kafka.topic":"items",\n"rabbitmq.host":"rabbitmq",\n"rabbitmq.port":"5672",\n"rabbitmq.queue":"items",\n"rabbitmq.username":"rabbit-user",\n"rabbitmq.password":"rabbit-pass",\n"rabbitmq.prefetch.count":"500",\n"rabbitmq.automatic.recovery.enabled":"true",\n"rabbitmq.network.recovery.interval.ms":"10000",\n"rabbitmq.topology.recovery.enabled":"true",\n"name":"RabbitMQSourceConnector"},\n"tasks":[],\n"type":"source"}\n')),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"And then looking at the deployed connectors using ",Object(o.b)("a",{parentName:"p",href:"http://localhost:8083/connectors"},"http://localhost:8083/connectors")," or the RabbitMQ connector with ",Object(o.b)("a",{parentName:"p",href:"http://localhost:8083/connectors/RabbitMQSourceConnector"},"http://localhost:8083/connectors/RabbitMQSourceConnector")," to get the same response as the above json.")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Create ",Object(o.b)("inlineCode",{parentName:"p"},"items")," topic into Kafka using the script:"))),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-shell"},"./createTopics.sh\n")),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Send some records using the simulator at the ",Object(o.b)("a",{parentName:"p",href:"http://localhost:8080/#/simulator"},"http://localhost:8080/#/simulator")," URL by first selecting RabbitMQ button and the number of message to send: "),Object(o.b)("span",{parentName:"li",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(o.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"50%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABNElEQVQoz41S20rEMBDtj3l5kmVF8N0/8E90QV1f9NX/8Du6FSn4IAoKZReaNJ1cjpmk6UYpxYHTTE8yZ86kLc4faizvKpyuN1jclDi5rXC02uDwuvyFg6t9frwqsfA1y3WFs/sXXD7VuHh8DVwhlIbsLT6+GtRv7/hudmg7giTreTOCtIUYcl6FMmhVXBly4AoMoXqCUh2s0XDWwD/gPHwCYx0+d4T/ROGc84UAUY+u6wIkQ8oApRTIODRCw9oo/hfMRx0XHXIyH75QE7TW2Vk3AKNYcJgT+ca+kXfg1+dyi613Gfl8f0Yw5UKIMG6+xxdurJtsPitorUXbtkGUR2QQ0TAyxdyYgCnxSYf8IdhhKmbRvu/DOzdkMJ9fzSiYO0uduTAHC3ID/gNYOImn81ybdH4Ampr7zrTjzTwAAAAASUVORK5CYII=')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(o.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"1",title:"1",src:"/refarch-eda/static/f2928e432cdc42581a42938ce766293e/3cbba/store-simul-rmq.png",srcSet:["/refarch-eda/static/f2928e432cdc42581a42938ce766293e/7fc1e/store-simul-rmq.png 288w","/refarch-eda/static/f2928e432cdc42581a42938ce766293e/a5df1/store-simul-rmq.png 576w","/refarch-eda/static/f2928e432cdc42581a42938ce766293e/3cbba/store-simul-rmq.png 1152w","/refarch-eda/static/f2928e432cdc42581a42938ce766293e/2e899/store-simul-rmq.png 1370w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    "))),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Verify the RabbitMQ settings")),Object(o.b)("p",null,"In a Web Browser go to ",Object(o.b)("a",{parentName:"p",href:"http://localhost:15672/"},"http://localhost:15672/")," using the rabbit-user/rabbit-pass login."),Object(o.b)("p",null,"You should reach this console:"),Object(o.b)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(o.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"40.27777777777778%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABKElEQVQoz31SYW+CMBTs//89+7BvS7YlikwSgptiw4bgYICgooBA4dY2wFime8n1tX3NvXuXEuy3QEjB0giXskRVVTifMzDGMI62bf9ARF0zZFmGPM9RFAXIm67h4f4Ox2THic5I03SAeNQ/bppGNrkGUetBgjACtd6RFxepruxUitxDnG+R1XX9CyTjqvZJgjiOcTqdBiXjrmK88fk/EDHm4XCQo92Ka/7dArFtG6qqwjRNCcMwsFqtJHzfRxRFA+kPudwMd11buRLHcaDrOizLwpquJRGlVO4935OEvYci10x4VaHifjE+Ytn5LfwTdWJvuEJFxcJZQAkVLBKevxQsd0vMPmfQAg0Td4J5MMfUnUINXrBxP2C6HtbxEdrrEs9Pj1KU+Dbf2ghlXX/GZDoAAAAASUVORK5CYII=')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(o.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"7",title:"7",src:"/refarch-eda/static/4ef70acaeaa0ffa5c8bfa7425adac422/3cbba/rabbitmq-overview.png",srcSet:["/refarch-eda/static/4ef70acaeaa0ffa5c8bfa7425adac422/7fc1e/rabbitmq-overview.png 288w","/refarch-eda/static/4ef70acaeaa0ffa5c8bfa7425adac422/a5df1/rabbitmq-overview.png 576w","/refarch-eda/static/4ef70acaeaa0ffa5c8bfa7425adac422/3cbba/rabbitmq-overview.png 1152w","/refarch-eda/static/4ef70acaeaa0ffa5c8bfa7425adac422/0b124/rabbitmq-overview.png 1728w","/refarch-eda/static/4ef70acaeaa0ffa5c8bfa7425adac422/25a1a/rabbitmq-overview.png 2000w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    "),Object(o.b)("p",null,"Go to the Queue tab and select the ",Object(o.b)("inlineCode",{parentName:"p"},"items")," queue:"),Object(o.b)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(o.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"28.819444444444443%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAvklEQVQY06VQ0QqDMAz0/79tb744RPFBO2utRVBBbXvzAgVh29MCR3qX5EiaFUUBpRTO84T3/m9kfd9jnmccx4EQwkdDjPGr/tPQWott27Cuq+Q0nLJzTmo0vgd5wl3L2JzOjcFTlgI33vddajRnMN95iruW1XWNcRyxLAuUnaD0ADdNaJoGVVXBGCN/PF0avyfPc5RlCa21cC5EcAEx5GDXtldR49EZPLsX1MWHYRAzDtGQBtQIvhPYw0vSyW/Q7dBTuixYFAAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(o.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"9",title:"9",src:"/refarch-eda/static/608e809e882493e3f37f0bade964d0e1/3cbba/rabbitmq-item-queue-2.png",srcSet:["/refarch-eda/static/608e809e882493e3f37f0bade964d0e1/7fc1e/rabbitmq-item-queue-2.png 288w","/refarch-eda/static/608e809e882493e3f37f0bade964d0e1/a5df1/rabbitmq-item-queue-2.png 576w","/refarch-eda/static/608e809e882493e3f37f0bade964d0e1/3cbba/rabbitmq-item-queue-2.png 1152w","/refarch-eda/static/608e809e882493e3f37f0bade964d0e1/46052/rabbitmq-item-queue-2.png 1382w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    "),Object(o.b)("p",null,"And then get 1 message from the queue:"),Object(o.b)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1152px"}},"\n      ",Object(o.b)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"69.79166666666667%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZUlEQVQ4y62TWW7DMAxEff/75K83yAn6ESAw7Nr1vsq7WT22Cox0AZqWACGKpoYzlOzt9avs0bPMVSJmGKRpGum6Tuq6ljzPZRxH+cm2bZPBnqMO94wxkqWpRFGkIG3bKmBRFHI+nyV6CWVdV1mWRX3b1tvexYA690hM0yTzPN8+su77rmz7vtVc3/eSZplAgG+ZjSHgam+AgDVNJ4OZxPSjPThYhsY2WCSOYynz4kOWsSpiW2NU6rvMScGO5kGdLjBAKg1cR/YwJ2Y+gLJSCyBO7M7C3qMYabABHGMlV5alNsOTJJHUzprDNKUGFY4QJIg9GHCbAP+H6QyDIFDK7hnc39xv3GMmSEEyKzeHLPIPAXZ2VsH1KqFlGYahDvZPkq+XizydTtJZZthuuzDgR11nWNjbrKpK5bqbvn9f39mXgL7vq9Tjq3cFLj7O6bj/9LBJwo7ng9PA/Yo4l3PM37sDdATeAPLiSKL2JModAAAAAElFTkSuQmCC')",backgroundSize:"cover",display:"block"}}),"\n  ",Object(o.b)("img",{parentName:"span",className:"gatsby-resp-image-image",alt:"10",title:"10",src:"/refarch-eda/static/fc9a443023a6daa5839e72dc5a907203/3cbba/rabbitmq-item-msgs.png",srcSet:["/refarch-eda/static/fc9a443023a6daa5839e72dc5a907203/7fc1e/rabbitmq-item-msgs.png 288w","/refarch-eda/static/fc9a443023a6daa5839e72dc5a907203/a5df1/rabbitmq-item-msgs.png 576w","/refarch-eda/static/fc9a443023a6daa5839e72dc5a907203/3cbba/rabbitmq-item-msgs.png 1152w","/refarch-eda/static/fc9a443023a6daa5839e72dc5a907203/3f238/rabbitmq-item-msgs.png 1195w"],sizes:"(max-width: 1152px) 100vw, 1152px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"}),"\n    "),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Now verify the Kafka connect-* topics are created successfully:"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",{parentName:"pre",className:"language-shell"},'docker run -ti --network  rabbitmq-source-lab_default strimzi/kafka:latest-kafka-2.6.0 bash -c "/opt/kafka/bin/kafka-topics.sh --bootstrap-server kafka:9092 --list"\n# you should get at least\n__consumer_offsets\nconnect-configs\nconnect-offsets\nconnect-status\nitems\n'))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Verify the message arrived to the ",Object(o.b)("inlineCode",{parentName:"p"},"items")," in kafka topic:"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",{parentName:"pre",className:"language-shell"},'docker run -ti --network  rabbitmq-source-lab_default  strimzi/kafka:latest-kafka-2.6.0 bash -c "/opt/kafka/bin/kafka-console-consumer.sh --bootstrap-server kafka:9092 --topic items --from-beginning"\n\n# You may have a trace like which maps the messages sent \n"{\\"id\\":0,\\"price\\":11.0,\\"quantity\\":6,\\"sku\\":\\"Item_5\\",\\"storeName\\":\\"Store_3\\",\\"timestamp\\":\\"2020-10-23T19:11:26.395325\\",\\"type\\":\\"SALE\\"}"\n"{\\"id\\":1,\\"price\\":68.5,\\"quantity\\":0,\\"sku\\":\\"Item_5\\",\\"storeName\\":\\"Store_1\\",\\"timestamp\\":\\"2020-10-23T19:11:26.395447\\",\\"type\\":\\"SALE\\"}"\n')))),Object(o.b)("p",null,"You validated the solution works end to end. Now we can try to deploy those components to OpenShift."),Object(o.b)("h2",null,"Deploy on OpenShift"),Object(o.b)("p",null,"In this section, you will deploy the Kafka connector and Rabbit MQ on OpenShift using Event Streams on Premise as Kafka cluster."),Object(o.b)("h3",null,"Pre-requisites"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"To run the demonstration be sure to have the event store simulator deployed: ",Object(o.b)("a",{parentName:"li",href:""},"see instructions here."))),Object(o.b)("p",null,Object(o.b)("em",{parentName:"p"},"Pull in necessary pre-req from the ",Object(o.b)("a",{parentName:"em",href:"/refarch-eda/scenarios/realtime-inventory/#general-pre-requisites"},"Realtime Inventory Pre-reqs"),", like for example the deployment of the store simulator.")),Object(o.b)("h3",null,"Deploy RabbitMQ using operators"),Object(o.b)("p",null,"See ",Object(o.b)("a",{parentName:"p",href:"https://www.rabbitmq.com/kubernetes/operator/install-operator.html"},"the installation instructions")," to get a RabbitMQ ",Object(o.b)("strong",{parentName:"p"},"operator")," installed, or use our manifests from the ",Object(o.b)("a",{parentName:"p",href:"https://github.com/ibm-cloud-architecture/refarch-eda-tools"},"refarch-eda-tools")," repository, which will set user 1000 and 999 for OpenShift deployment. The RabbitMQ cluster operator runs as user ID ",Object(o.b)("inlineCode",{parentName:"p"},"1000"),". The RabbitMQ pod runs the RabbitMQ container as user ID ",Object(o.b)("inlineCode",{parentName:"p"},"999")," and an init container as user ID ",Object(o.b)("inlineCode",{parentName:"p"},"0"),"."),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Create a dedicated project to run RabbitMQ operator to observe any projects, and install CRD, service account, RBAC role, deployment… "),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",{parentName:"pre",className:"language-shell"},"oc new-project rabbitmq-system\n# under the labs/rabbitmq-source-lab folder do\nkubectl apply -f cluster-operator.yml\n\nkubectl get customresourcedefinitions.apiextensions.k8s.io\n"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Create a second project for RabbitMQ cluster. It is recommended to have separate project for RabbitMQ cluster.\nModify the namespace to be able to deploy RabbitMQ cluster into it. So we need to get user 999 authorized. For that we specify a security constraint named: ",Object(o.b)("inlineCode",{parentName:"p"},"rabbitmq-cluster")),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",{parentName:"pre",className:"language-shell"}," #Define a Security Context Constraint\n oc apply -f rmq-scc.yaml\n"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Update the name space to get openshift scc userid and groupid range. You can do that in two ways, by directly editing the namespace definition:"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",{parentName:"pre",className:"language-shell"}," oc edit namespace rabbitmq-cluster\n # Then add the following annotations:\n annotations:\n   openshift.io/sa.scc.supplemental-groups: 999/1\n   openshift.io/sa.scc.uid-range: 0-999/1\n")),Object(o.b)("p",{parentName:"li"},"Or by using our custom cluster definition: ",Object(o.b)("inlineCode",{parentName:"p"},"oc apply -f rmq-cluster-ns.yaml"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"For every RabbitMQ cluster assign the previously created security context constraint to the cluster’s service account: ",Object(o.b)("inlineCode",{parentName:"p"}," oc adm policy add-scc-to-user rabbitmq-cluster -z rmqcluster-rabbitmq-server"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Finally create a cluster instance: ",Object(o.b)("inlineCode",{parentName:"p"},"oc apply -f rmq-cluster.yaml"),".")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Define a route on the client service on port 15672")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Get the admin user and password as defined in the secrets"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",{parentName:"pre",className:"language-shell"}," oc describe secret rmqcluster-rabbitmq-default-user\n # Get user name\n oc get secret rmqcluster-rabbitmq-default-user  -o jsonpath='{.data.username}' | base64 --decode \n # Get password\n oc get secret rmqcluster-rabbitmq-default-user  -o jsonpath='{.data.password}' | base64 --decode \n")))),Object(o.b)("p",null,"To validate the RabbitMQ cluster runs correctly you can use the RabbitMQ console, and add the ",Object(o.b)("inlineCode",{parentName:"p"},"items")," queue."),Object(o.b)("h2",null,"Configure the kafka connector for Rabbitmq source"),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"rabbitmq-source.json")," define the connector and the RabbitMQ connection parameters:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-json"},'{\n    "name": "RabbitMQSourceConnector",\n    "config": {\n        "connector.class": "com.ibm.eventstreams.connect.rabbitmqsource.RabbitMQSourceConnector",\n        "tasks.max": "1",\n        "kafka.topic" : "items",\n        "rabbitmq.host": "rabbitmq",\n        "rabbitmq.port": 5672,\n        "rabbitmq.queue" : "items",\n        "rabbitmq.prefetch.count" : "500",\n        "rabbitmq.automatic.recovery.enabled" : "true",\n        "rabbitmq.network.recovery.interval.ms" : "10000",\n        "rabbitmq.topology.recovery.enabled" : "true"\n    }\n}\n')),Object(o.b)("p",null,"This file is uploaded to Kafka Connect via a PORT operation:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-shell"},'curl -X POST -H "Content-Type: application/json" http://localhost:8083/connectors   --data "@./rabbitmq-source.json"\n')),Object(o.b)("p",null,"To verify use: ",Object(o.b)("inlineCode",{parentName:"p"},"curl -X GET http://localhost:8083/connectors"),"."),Object(o.b)("p",null,"In Kafka connect trace you should see:"),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-shell"},"[Worker clientId=connect-1, groupId=eda-kconnect] Connector RabbitMQSourceConnector config updated\n...\nStarting connector RabbitMQSourceConnector\n...\n Starting task RabbitMQSourceConnector-0\n\n")),Object(o.b)("p",null,"And Rabbitmq that get the connection from Kafka Connect."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-shell"},"rabbitmq_1  [info] <0.1766.0> accepting AMQP connection <0.1766.0> (172.19.0.3:33040 -> 172.19.0.2:5672)\nkconnect_1  INFO Creating Channel (com.ibm.eventstreams.connect.rabbitmqsource.RabbitMQSourceTask:61)\nrabbitmq_1  connection <0.1766.0> (172.19.0.3:33040 -> 172.19.0.2:5672): user 'rabbit-user' authenticated and granted access to vhost '/'\n")))}u.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-use-cases-connect-rabbitmq-index-mdx-fb893f66837c5879acaa.js.map